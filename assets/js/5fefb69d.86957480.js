"use strict";(self.webpackChunkxlog=self.webpackChunkxlog||[]).push([[7168],{5766:(n,o,e)=>{e.r(o),e.d(o,{assets:()=>t,contentTitle:()=>c,default:()=>d,frontMatter:()=>s,metadata:()=>l,toc:()=>i});var r=e(4848),a=e(8453);const s={id:"haproxy-1",author:"Ryan",title:"HAProxy-\u5b89\u88c5\u53ca\u57fa\u7840\u914d\u7f6e",date:"2024-06-07T12:33"},c=void 0,l={id:"haproxy-1",title:"HAProxy-\u5b89\u88c5\u53ca\u57fa\u7840\u914d\u7f6e",description:"\u4e09\u3001HAProxy\u5b89\u88c5\u53ca\u57fa\u7840\u914d\u7f6e",source:"@site/src/haproxy/Haproxy-1.md",sourceDirName:".",slug:"/haproxy-1",permalink:"/haproxy/haproxy-1",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/src/haproxy/Haproxy-1.md",tags:[],version:"current",frontMatter:{id:"haproxy-1",author:"Ryan",title:"HAProxy-\u5b89\u88c5\u53ca\u57fa\u7840\u914d\u7f6e",date:"2024-06-07T12:33"},sidebar:"haproxySidebar"},t={},i=[{value:"\u4e09\u3001HAProxy\u5b89\u88c5\u53ca\u57fa\u7840\u914d\u7f6e",id:"\u4e09haproxy\u5b89\u88c5\u53ca\u57fa\u7840\u914d\u7f6e",level:2},{value:"3.1 \u6e90\u7801\u5305\u5b89\u88c5",id:"31-\u6e90\u7801\u5305\u5b89\u88c5",level:3},{value:"ubuntu \u5b89\u88c5",id:"ubuntu-\u5b89\u88c5",level:4},{value:"Centos\u5b89\u88c5",id:"centos\u5b89\u88c5",level:4},{value:"3.2 \u7f16\u8bd1\u5b89\u88c5HAProxy",id:"32-\u7f16\u8bd1\u5b89\u88c5haproxy",level:3},{value:"3.2.1 \u89e3\u51b3lua\u73af\u5883",id:"321-\u89e3\u51b3lua\u73af\u5883",level:4},{value:"3.2.2 \u5f00\u59cb\u7f16\u8bd1\u5b89\u88c5",id:"322-\u5f00\u59cb\u7f16\u8bd1\u5b89\u88c5",level:4},{value:"3.2.3 HAProxy\u542f\u52a8\u811a\u672c",id:"323-haproxy\u542f\u52a8\u811a\u672c",level:4},{value:"3.2.4 \u521b\u5efa\u914d\u7f6e\u6587\u4ef6",id:"324-\u521b\u5efa\u914d\u7f6e\u6587\u4ef6",level:4},{value:"3.2.5 \xa0\u542f\u52a8haproxy",id:"325-\u542f\u52a8haproxy",level:4},{value:"3.3 \u9a8c\u8bc1haproxy\u72b6\u6001",id:"33-\u9a8c\u8bc1haproxy\u72b6\u6001",level:3},{value:"3.3.1 \u9a8c\u8bc1\u76d1\u542c\u7aef\u53e3",id:"331-\u9a8c\u8bc1\u76d1\u542c\u7aef\u53e3",level:4},{value:"3.3.2 \u67e5\u770bhaproxy\u7684\u72b6\u6001\u9875\u9762",id:"332-\u67e5\u770bhaproxy\u7684\u72b6\u6001\u9875\u9762",level:4},{value:"3.3.3 \u6d4b\u8bd5\u8f6c\u53d1",id:"333-\u6d4b\u8bd5\u8f6c\u53d1",level:4}];function u(n){const o={a:"a",code:"code",h2:"h2",h3:"h3",h4:"h4",hr:"hr",img:"img",p:"p",pre:"pre",strong:"strong",...(0,a.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("a",{name:"45409794"}),"\n",(0,r.jsx)(o.h2,{id:"\u4e09haproxy\u5b89\u88c5\u53ca\u57fa\u7840\u914d\u7f6e",children:"\u4e09\u3001HAProxy\u5b89\u88c5\u53ca\u57fa\u7840\u914d\u7f6e"}),"\n",(0,r.jsx)(o.p,{children:"\u4ecb\u7ecdHAProxy\u7684\u57fa\u7840\u5b89\u88c5\u53ca\u57fa\u7840\u914d\u7f6e"}),"\n",(0,r.jsx)("a",{name:"b62d7d45"}),"\n",(0,r.jsx)(o.h3,{id:"31-\u6e90\u7801\u5305\u5b89\u88c5",children:"3.1 \u6e90\u7801\u5305\u5b89\u88c5"}),"\n",(0,r.jsxs)(o.p,{children:["\u5b98\u65b9\u63d0\u4f9b\u4e86Ubuntu\u548cDebian\u7684\u5305\uff0c\u6ca1\u6709Centos\u7684\u5305",(0,r.jsx)("br",{}),(0,r.jsx)(o.img,{src:"https://cdn1.ryanxin.live/1675997727329-efbe55ed-cb1e-4446-b7d2-40fd13d1031b.png#alt=",alt:""})]}),"\n",(0,r.jsx)(o.hr,{}),"\n",(0,r.jsx)(o.p,{children:(0,r.jsx)(o.img,{src:"https://cdn1.ryanxin.live/xxlog/1675997822880-a7a98a7a-9d66-4040-902e-4575f17bcaf5.png#alt=image.png",alt:""})}),"\n",(0,r.jsx)("a",{name:"0aa51ed0"}),"\n",(0,r.jsx)(o.h4,{id:"ubuntu-\u5b89\u88c5",children:"ubuntu \u5b89\u88c5"}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-yaml",children:"apt-get install --no-install-recommends software-properties-common \n#--no-install-recommends \u53c2\u6570\u6765\u907f\u514d\u5b89\u88c5\u975e\u5fc5\u987b\u7684\u6587\u4ef6\uff0c\u4ece\u800c\u51cf\u5c0f\u955c\u50cf\u7684\u4f53\u79ef\nadd-apt-repository ppa:vbernat/haproxy-2.6\napt-get install haproxy=2.6.\\*\n"})}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-bash",children:"#\u5b89\u88c5\u5e38\u7528\u8f6f\u4ef6\u5305\napt-get install --no-install-recommends software-properties-common -y\n#--no-install-recommends \u53c2\u6570\u6765\u907f\u514d\u5b89\u88c5\u975e\u5fc5\u987b\u7684\u6587\u4ef6\uff0c\u4ece\u800c\u51cf\u5c0f\u955c\u50cf\u7684\u4f53\u79ef\n\n\n#\u5b89\u88c5\u6e90\nroot@etcd01[11:10:22]~ #:add-apt-repository ppa:vbernat/haproxy-2.6\n HAProxy is a free, very fast and reliable solution offering high availability, load balancing, and proxying for TCP and HTTP-based applications. It is particularly suited for web sites crawling under very high loads while needing persistence or Layer7 processing. Supporting tens of thousands of connections is clearly realistic with todays hardware. Its mode of operation makes its integration into existing architectures very easy and riskless, while still offering the possibility not to expose fragile web servers to the Net.\n\nThis PPA contains packages for HAProxy 2.6.\n More info: https://launchpad.net/~vbernat/+archive/ubuntu/haproxy-2.6\nPress [ENTER] to continue or Ctrl-c to cancel adding it.\n\nGet:1 http://ppa.launchpad.net/vbernat/haproxy-2.6/ubuntu focal InRelease [23.8 kB]\nHit:2 http://cn.archive.ubuntu.com/ubuntu focal InRelease \nHit:3 http://cn.archive.ubuntu.com/ubuntu focal-updates InRelease\nHit:4 http://cn.archive.ubuntu.com/ubuntu focal-backports InRelease\nHit:5 http://cn.archive.ubuntu.com/ubuntu focal-security InRelease         \nGet:6 http://ppa.launchpad.net/vbernat/haproxy-2.6/ubuntu focal/main amd64 Packages [1,000 B]\nGet:7 http://ppa.launchpad.net/vbernat/haproxy-2.6/ubuntu focal/main Translation-en [704 B]\nFetched 25.5 kB in 2s (14.0 kB/s)                     \nReading package lists... Done\n\n\n#\u67e5\u770b\u53ef\u7528\u7248\u672c\nroot@etcd01[11:11:01]~ #:apt-cache madison haproxy\n   haproxy | 2.6.8-1ppa1~focal | http://ppa.launchpad.net/vbernat/haproxy-2.6/ubuntu focal/main amd64 Packages\n   haproxy | 2.0.29-0ubuntu1.1 | http://cn.archive.ubuntu.com/ubuntu focal-updates/main amd64 Packages\n   haproxy | 2.0.29-0ubuntu1.1 | http://cn.archive.ubuntu.com/ubuntu focal-security/main amd64 Packages\n   haproxy |   2.0.13-2 | http://cn.archive.ubuntu.com/ubuntu focal/main amd64 Packages\n\n#\u5b89\u88c52.6\napt-get install haproxy=2.6.\\* -y\n\n\n#\u9a8c\u8bc1haproxy\u7248\u672c\nroot@etcd01[13:50:48]~ #:haproxy -v\nHAProxy version 2.6.8-1ppa1~focal 2023/01/24 - https://haproxy.org/\nStatus: long-term supported branch - will stop receiving fixes around Q2 2027.\nKnown bugs: http://www.haproxy.org/bugs/bugs-2.6.8.html\nRunning on: Linux 5.4.0-135-generic #152-Ubuntu SMP Wed Nov 23 20:19:22 UTC 2022 x86_64\n"})}),"\n",(0,r.jsx)("a",{name:"f1c7cd61"}),"\n",(0,r.jsx)(o.h4,{id:"centos\u5b89\u88c5",children:"Centos\u5b89\u88c5"}),"\n",(0,r.jsxs)(o.p,{children:["\u5728centos\u7cfb\u7edf\u4e0a\u901a\u8fc7yum\u3001\u7f16\u8bd1\u7b49\u591a\u79cd\u5b89\u88c5\u65b9\u5f0f\u3002",(0,r.jsx)("br",{}),(0,r.jsx)(o.strong,{children:"\u9ed8\u8ba4yum\u6e90"}),(0,r.jsx)("br",{}),"\u9ed8\u8ba4\u7684base\u4ed3\u5e93\u4e2d\u5305\u542bhaproxy\u7684\u5b89\u88c5\u5305\u6587\u4ef6\uff0c\u4f46\u662f\u7248\u672c\u6bd4\u8f83\u65e7\uff0c\u662f1.5.18\u7684\u7248\u672c\uff0c\u8ddd\u79bb\u5f53\u524d\u7248\u672c\u5df2\u7ecf\u6709\u8f83\u957f\u65f6\u95f4\u6ca1\u6709\u66f4\u65b0\uff0c\u7531\u4e8e\u7248\u672c\u6bd4\u8f83\u65e7\u6240\u4ee5\u6709\u5f88\u591a\u529f\u80fd\u4e0d\u652f\u6301\uff0c\u5982\u679c\u5bf9\u529f\u80fd\u548c\u6027\u80fd\u6ca1\u6709\u8981\u6c42\u53ef\u4ee5\u4f7f\u7528\u6b64\u7248\u672c\uff0c\u5426\u5219\u63a8\u8350\u4f7f\u7528\u65b0\u7248\u672c\u3002"]}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-bash",children:"# yum install haproxy -y\n#\u9a8c\u8bc1haproxy\u7248\u672c\n# haproxy -v\nHA-Proxy version 1.5.18 2016/05/10\nCopyright 2000-2016 Willy Tarreau <willy@haproxy.org>\n"})}),"\n",(0,r.jsx)("a",{name:"ce56c46c"}),"\n",(0,r.jsx)(o.h3,{id:"32-\u7f16\u8bd1\u5b89\u88c5haproxy",children:"3.2 \u7f16\u8bd1\u5b89\u88c5HAProxy"}),"\n",(0,r.jsxs)(o.p,{children:["\u7f16\u8bd1\u5b89\u88c5HAProxy 2.0 LTS\u7248\u672c\uff0c\u6e90\u7801\u5305\u4e0b\u8f7d\u5730\u5740\uff1a",(0,r.jsx)(o.a,{href:"http://www.haproxy.org/download/",children:"http://www.haproxy.org/download/"})]}),"\n",(0,r.jsx)("a",{name:"5ffc492b"}),"\n",(0,r.jsx)(o.h4,{id:"321-\u89e3\u51b3lua\u73af\u5883",children:"3.2.1 \u89e3\u51b3lua\u73af\u5883"}),"\n",(0,r.jsx)(o.p,{children:"HAProxy\u652f\u6301\u57fa\u4e8elua\u5b9e\u73b0\u529f\u80fd\u6269\u5c55\uff0clua\u662f\u4e00\u79cd\u5c0f\u5de7\u7684\u811a\u672c\u8bed\u8a00\uff0c\u4e8e1993\u5e74\u7531\u5df4\u897f\u91cc\u7ea6\u70ed\u5185\u5362\u5929\u4e3b\u6559\u5927\u5b66\uff08Ponti\ufb01cal Catholic University of Rio de Janeiro\uff09\u91cc\u7684\u4e00\u4e2a\u7814\u7a76\u5c0f\u7ec4\u5f00\u53d1\uff0c\u5176\u8bbe\u8ba1\u76ee\u7684\u662f\u4e3a\u4e86\u5d4c\u5165\u5e94\u7528\u7a0b\u5e8f\u4e2d\uff0c\u4ece\u800c\u4e3a\u5e94\u7528\u7a0b\u5e8f\u63d0\u4f9b\u7075\u6d3b\u7684\u6269\u5c55\u548c\u5b9a\u5236\u529f\u80fd\u3002"}),"\n",(0,r.jsxs)(o.p,{children:["Lua \u5b98\u7f51\uff1a",(0,r.jsx)(o.a,{href:"http://www.lua.org",children:"www.lua.org"})]}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-bash",children:"Lua\u5e94\u7528\u573a\u666f\n\u6e38\u620f\u5f00\u53d1\n\u72ec\u7acb\u5e94\u7528\u811a\u672c\nWeb\u5e94\u7528\u811a\u672c\n\u6269\u5c55\u548c\u6570\u636e\u5e93\u63d2\u4ef6\uff0c\u5982MySQL Proxy\n\u5b89\u5168\u7cfb\u7edf\uff0c\u5982\u5165\u4fb5\u68c0\u6d4b\u7cfb\u7edf\n"})}),"\n",(0,r.jsx)(o.hr,{}),"\n",(0,r.jsxs)(o.p,{children:[(0,r.jsx)(o.strong,{children:"Centos \u73af\u5883"}),"\uff1a",(0,r.jsx)("br",{}),"\u7531\u4e8ecentos\u81ea\u5e26\u7684lua\u7248\u672c\u6bd4\u8f83\u4f4e\u5e76\u4e0d\u7b26\u5408HAProxy\u8981\u6c42\u7684lua\u6700\u4f4e\u7248\u672c(5.3)\u7684\u8981\u6c42\uff0c\u56e0\u6b64\u9700\u8981\u7f16\u8bd1\u5b89\u88c5\u8f83\u65b0\u7248\u672c\u7684lua\u73af\u5883\uff0c\u7136\u540e\u624d\u80fd\u7f16\u8bd1\u5b89\u88c5HAProxy\uff0c\u8fc7\u7a0b\u5982\u4e0b\uff1a"]}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-bash",children:'#\u5f53\u524d\u7cfb\u7edf\u7248\u672c\n[root@centos7 ~]#lua -v \nLua 5.1.4  Copyright (C) 1994-2008 Lua.org, PUC-Rio\n\n#\u5b89\u88c5\u57fa\u7840\u547d\u4ee4\u53ca\u7f16\u8bd1\u4f9d\u8d56\u73af\u5883\n[root@centos7 ~]# yum install gcc readline-devel\n[root@centos7 ~]# wget http://www.lua.org/ftp/lua-5.3.5.tar.gz\n[root@centos7 ~]# tar xvf  lua-5.3.5.tar.gz -C /usr/local/src\n[root@centos7 ~]# cd /usr/local/src/lua-5.3.5\n[root@centos7 lua-5.3.5]# make linux test\n\n\n[root@localhost lua-5.3.5]# make linux test\ncd src && make linux\nmake[1]: \u8fdb\u5165\u76ee\u5f55\u201c/usr/local/src/lua-5.3.5/src\u201d\nmake all SYSCFLAGS="-DLUA_USE_LINUX" SYSLIBS="-Wl,-E -ldl -lreadline"\nmake[2]: \u8fdb\u5165\u76ee\u5f55\u201c/usr/local/src/lua-5.3.5/src\u201d\ngcc -std=gnu99 -O2 -Wall -Wextra -DLUA_COMPAT_5_2 -DLUA_USE_LINUX    -c -o lapi.o lapi.c\ngcc -std=gnu99 -O2 -Wall -Wextra -DLUA_COMPAT_5_2 -DLUA_USE_LINUX    -c -o lcode.o lcode.c\ngcc -std=gnu99 -O2 -Wall -Wextra -DLUA_COMPAT_5_2 -DLUA_USE_LINUX    -c -o lctype.o lctype.c\ngcc -std=gnu99 -O2 -Wall -Wextra -DLUA_COMPAT_5_2 -DLUA_USE_LINUX    -c -o ldebug.o ldebug.c\ngcc -std=gnu99 -O2 -Wall -Wextra -DLUA_COMPAT_5_2 -DLUA_USE_LINUX    -c -o ldo.o ldo.c\ngcc -std=gnu99 -O2 -Wall -Wextra -DLUA_COMPAT_5_2 -DLUA_USE_LINUX    -c -o ldump.o ldump.c\ngcc -std=gnu99 -O2 -Wall -Wextra -DLUA_COMPAT_5_2 -DLUA_USE_LINUX    -c -o lfunc.o lfunc.c\ngcc -std=gnu99 -O2 -Wall -Wextra -DLUA_COMPAT_5_2 -DLUA_USE_LINUX    -c -o lgc.o lgc.c\ngcc -std=gnu99 -O2 -Wall -Wextra -DLUA_COMPAT_5_2 -DLUA_USE_LINUX    -c -o llex.o llex.c\ngcc -std=gnu99 -O2 -Wall -Wextra -DLUA_COMPAT_5_2 -DLUA_USE_LINUX    -c -o lmem.o lmem.c\ngcc -std=gnu99 -O2 -Wall -Wextra -DLUA_COMPAT_5_2 -DLUA_USE_LINUX    -c -o lobject.o lobject.c\ngcc -std=gnu99 -O2 -Wall -Wextra -DLUA_COMPAT_5_2 -DLUA_USE_LINUX    -c -o lopcodes.o lopcodes.c\ngcc -std=gnu99 -O2 -Wall -Wextra -DLUA_COMPAT_5_2 -DLUA_USE_LINUX    -c -o lparser.o lparser.c\ngcc -std=gnu99 -O2 -Wall -Wextra -DLUA_COMPAT_5_2 -DLUA_USE_LINUX    -c -o lstate.o lstate.c\ngcc -std=gnu99 -O2 -Wall -Wextra -DLUA_COMPAT_5_2 -DLUA_USE_LINUX    -c -o lstring.o lstring.c\ngcc -std=gnu99 -O2 -Wall -Wextra -DLUA_COMPAT_5_2 -DLUA_USE_LINUX    -c -o ltable.o ltable.c\ngcc -std=gnu99 -O2 -Wall -Wextra -DLUA_COMPAT_5_2 -DLUA_USE_LINUX    -c -o ltm.o ltm.c\ngcc -std=gnu99 -O2 -Wall -Wextra -DLUA_COMPAT_5_2 -DLUA_USE_LINUX    -c -o lundump.o lundump.c\ngcc -std=gnu99 -O2 -Wall -Wextra -DLUA_COMPAT_5_2 -DLUA_USE_LINUX    -c -o lvm.o lvm.c\ngcc -std=gnu99 -O2 -Wall -Wextra -DLUA_COMPAT_5_2 -DLUA_USE_LINUX    -c -o lzio.o lzio.c\ngcc -std=gnu99 -O2 -Wall -Wextra -DLUA_COMPAT_5_2 -DLUA_USE_LINUX    -c -o lauxlib.o lauxlib.c\ngcc -std=gnu99 -O2 -Wall -Wextra -DLUA_COMPAT_5_2 -DLUA_USE_LINUX    -c -o lbaselib.o lbaselib.c\ngcc -std=gnu99 -O2 -Wall -Wextra -DLUA_COMPAT_5_2 -DLUA_USE_LINUX    -c -o lbitlib.o lbitlib.c\ngcc -std=gnu99 -O2 -Wall -Wextra -DLUA_COMPAT_5_2 -DLUA_USE_LINUX    -c -o lcorolib.o lcorolib.c\ngcc -std=gnu99 -O2 -Wall -Wextra -DLUA_COMPAT_5_2 -DLUA_USE_LINUX    -c -o ldblib.o ldblib.c\ngcc -std=gnu99 -O2 -Wall -Wextra -DLUA_COMPAT_5_2 -DLUA_USE_LINUX    -c -o liolib.o liolib.c\ngcc -std=gnu99 -O2 -Wall -Wextra -DLUA_COMPAT_5_2 -DLUA_USE_LINUX    -c -o lmathlib.o lmathlib.c\ngcc -std=gnu99 -O2 -Wall -Wextra -DLUA_COMPAT_5_2 -DLUA_USE_LINUX    -c -o loslib.o loslib.c\ngcc -std=gnu99 -O2 -Wall -Wextra -DLUA_COMPAT_5_2 -DLUA_USE_LINUX    -c -o lstrlib.o lstrlib.c\ngcc -std=gnu99 -O2 -Wall -Wextra -DLUA_COMPAT_5_2 -DLUA_USE_LINUX    -c -o ltablib.o ltablib.c\ngcc -std=gnu99 -O2 -Wall -Wextra -DLUA_COMPAT_5_2 -DLUA_USE_LINUX    -c -o lutf8lib.o lutf8lib.c\ngcc -std=gnu99 -O2 -Wall -Wextra -DLUA_COMPAT_5_2 -DLUA_USE_LINUX    -c -o loadlib.o loadlib.c\ngcc -std=gnu99 -O2 -Wall -Wextra -DLUA_COMPAT_5_2 -DLUA_USE_LINUX    -c -o linit.o linit.c\nar rcu liblua.a lapi.o lcode.o lctype.o ldebug.o ldo.o ldump.o lfunc.o lgc.o llex.o lmem.o lobject.o lopcodes.o lparser.o lstate.o lstring.o ltable.o ltm.o lundump.o lvm.o lzio.o lauxlib.o lbaselib.o lbitlib.o lcorolib.o ldblib.o liolib.o lmathlib.o loslib.o lstrlib.o ltablib.o lutf8lib.o loadlib.o linit.o \nranlib liblua.a\ngcc -std=gnu99 -O2 -Wall -Wextra -DLUA_COMPAT_5_2 -DLUA_USE_LINUX    -c -o lua.o lua.c\ngcc -std=gnu99 -o lua   lua.o liblua.a -lm -Wl,-E -ldl -lreadline \ngcc -std=gnu99 -O2 -Wall -Wextra -DLUA_COMPAT_5_2 -DLUA_USE_LINUX    -c -o luac.o luac.c\ngcc -std=gnu99 -o luac   luac.o liblua.a -lm -Wl,-E -ldl -lreadline \nmake[2]: \u79bb\u5f00\u76ee\u5f55\u201c/usr/local/src/lua-5.3.5/src\u201d\nmake[1]: \u79bb\u5f00\u76ee\u5f55\u201c/usr/local/src/lua-5.3.5/src\u201d\nsrc/lua -v\nLua 5.3.5  Copyright (C) 1994-2018 Lua.org, PUC-Rio\n\n\n#\u67e5\u770b\u7f16\u8bd1\u5b89\u88c5\u7684\u7248\u672c\n[root@localhost lua-5.3.5]# ./src/lua -v \nLua 5.3.5  Copyright (C) 1994-2018 Lua.org, PUC-Rio\n'})}),"\n",(0,r.jsx)(o.hr,{}),"\n",(0,r.jsx)(o.p,{children:(0,r.jsx)(o.strong,{children:"Ubuntu \u57fa\u7840\u73af\u5883"})}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-bash",children:"#\u5b89\u88c5\u57fa\u7840\u547d\u4ee4\u53ca\u7f16\u8bd1\u4f9d\u8d56\u73af\u5883\n$ apt  install gcc iproute2  ntpdate  tcpdump telnet traceroute nfs-kernel-server nfs-common  lrzsz tree  openssl libssl-dev libpcre3 libpcre3-dev zlib1g-dev  openssh-server  libreadline-dev libsystemd-dev\n\n$ cd /usr/local/src\n$ wget http://www.lua.org/ftp/lua-5.3.5.tar.gz\n$ tar xvf  lua-5.3.5.tar.gz\n$ cd lua-5.3.5\n$ make linux test\n\n$ pwd\n/usr/local/src/lua-5.3.5\n$ ./src/lua -v\nLua 5.3.5  Copyright (C) 1994-2018 Lua.org, PUC-Rio\n\n#\u6216\u5b89\u88c5\u7cfb\u7edf\u81ea\u5e26\u7684lua\n$ apt install  lua5.3=5.3.3-1ubuntu0.18.04.1\n$ lua5.3  -v\nLua 5.3.3  Copyright (C) 1994-2016 Lua.org, PUC-Rio\n"})}),"\n",(0,r.jsx)("a",{name:"2ebe16a6"}),"\n",(0,r.jsx)(o.h4,{id:"322-\u5f00\u59cb\u7f16\u8bd1\u5b89\u88c5",children:"3.2.2 \u5f00\u59cb\u7f16\u8bd1\u5b89\u88c5"}),"\n",(0,r.jsxs)(o.p,{children:[(0,r.jsx)(o.strong,{children:"Centos \u73af\u5883"}),(0,r.jsx)("br",{}),(0,r.jsx)(o.strong,{children:"ubuntu \u7cfb\u7edf\u63a8\u8350\u4f7f\u7528\u5305\u7ba1\u7406\u5668\u5b89\u88c5"})]}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-bash",children:"#HAProxy  1.8\u53ca1.9\u7248\u672c\u7f16\u8bd1\u53c2\u6570\uff1a\nmake  ARCH=x86_64 TARGET=linux2628 USE_PCRE=1 USE_OPENSSL=1 USE_ZLIB=1 USE_SYSTEMD=1  USE_CPU_AFFINITY=1  PREFIX=/usr/local/haproxy \n\n#HAProxy 2.0\u4ee5\u4e0a\u7248\u672c\u7f16\u8bd1\u53c2\u6570\uff1a\n[root@centos7 ~]$ yum -y install gcc openssl-devel pcre-devel systemd-devel\n\u5df2\u5b89\u88c5:\n  openssl-devel.x86_64 1:1.0.2k-25.el7_9                              systemd-devel.x86_64 0:219-78.el7_9.7                             \n\n\u4f5c\u4e3a\u4f9d\u8d56\u88ab\u5b89\u88c5:\n  keyutils-libs-devel.x86_64 0:1.5.8-3.el7       krb5-devel.x86_64 0:1.15.1-55.el7_9        libcom_err-devel.x86_64 0:1.42.9-19.el7      \n  libkadm5.x86_64 0:1.15.1-55.el7_9              libselinux-devel.x86_64 0:2.5-15.el7       libsepol-devel.x86_64 0:2.5-10.el7           \n  libverto-devel.x86_64 0:0.2.5-4.el7           \n\n\u4f5c\u4e3a\u4f9d\u8d56\u88ab\u5347\u7ea7:\n  e2fsprogs.x86_64 0:1.42.9-19.el7            e2fsprogs-libs.x86_64 0:1.42.9-19.el7         krb5-libs.x86_64 0:1.15.1-55.el7_9         \n  libcom_err.x86_64 0:1.42.9-19.el7           libgudev1.x86_64 0:219-78.el7_9.7             libss.x86_64 0:1.42.9-19.el7               \n  openssl.x86_64 1:1.0.2k-25.el7_9            openssl-libs.x86_64 1:1.0.2k-25.el7_9         systemd.x86_64 0:219-78.el7_9.7            \n  systemd-libs.x86_64 0:219-78.el7_9.7        systemd-python.x86_64 0:219-78.el7_9.7        systemd-sysv.x86_64 0:219-78.el7_9.7 \n\n\n------------------------------------------------------------------\n\n[root@centos7 ~]$ tar xvf haproxy-2.6.8.tar.gz -C /usr/local/src/\n[root@centos7 ~]$ cd /usr/local/src/haproxy-2.6.8/\n[root@centos7 haproxy-2.6.8]$ cat README \n\nThe HAProxy documentation has been split into a number of different files for\nease of use.\n\nPlease refer to the following files depending on what you're looking for :\n\n  - INSTALL for instructions on how to build and install HAProxy\n  - BRANCHES to understand the project's life cycle and what version to use\n  - LICENSE for the project's license\n  - CONTRIBUTING for the process to follow to submit contributions\n\nThe more detailed documentation is located into the doc/ directory :\n\n  - doc/intro.txt for a quick introduction on HAProxy\n  - doc/configuration.txt for the configuration's reference manual\n  - doc/lua.txt for the Lua's reference manual\n  - doc/SPOE.txt for how to use the SPOE engine\n  - doc/network-namespaces.txt for how to use network namespaces under Linux\n  - doc/management.txt for the management guide\n  - doc/regression-testing.txt for how to use the regression testing suite\n  - doc/peers.txt for the peers protocol reference\n  - doc/coding-style.txt for how to adopt HAProxy's coding style\n  - doc/internals for developer-specific documentation (not all up to date)\n\n----------------------------------------------------------------------------\n\n[root@centos7 haproxy-2.6.8]$ cat INSTALL\n\n\n\n\n#\u53c2\u8003INSTALL\u6587\u4ef6\u8fdb\u884c\u7f16\u8bd1\u5b89\u88c5\n$ make  ARCH=x86_64 TARGET=linux-glibc  USE_PCRE=1 USE_OPENSSL=1 USE_ZLIB=1  USE_SYSTEMD=1 USE_CPU_AFFINITY=1 USE_LUA=1 LUA_INC=/usr/local/src/lua-5.3.5/src/  LUA_LIB=/usr/local/src/lua-5.3.5/src/ PREFIX=/usr/local/haproxy\n  CC      src/ev_poll.o\n  CC      src/ev_epoll.o\n  CC      src/cpuset.o\n  CC      src/ssl_sample.o\n  CC      src/ssl_sock.o\n  CC      src/ssl_crtlist.o\n  CC      src/ssl_ckch.o\n  CC      src/ssl_utils.o\n  CC      src/cfgparse-ssl.o\n  CC      src/jwt.o\n  CC      src/hlua.o\n  CC      src/hlua_fcn.o\n  CC      src/namespace.o\n  CC      src/mux_h2.o\n  CC      src/mux_fcgi.o\n  CC      src/mux_h1.o\n  CC      src/tcpcheck.o\n  CC      src/stream.o\n  CC      src/stats.o\n  CC      src/http_ana.o\n  CC      src/server.o\n  CC      src/stick_table.o\n  CC      src/sample.o\n  CC      src/flt_spoe.o\n  CC      src/tools.o\n  CC      src/log.o\n  CC      src/cfgparse.o\n  CC      src/peers.o\n  CC      src/backend.o\n  CC      src/resolvers.o\n  CC      src/cli.o\n  CC      src/connection.o\n  CC      src/proxy.o\n  CC      src/http_htx.o\n  CC      src/cfgparse-listen.o\n  CC      src/pattern.o\n  CC      src/check.o\n  CC      src/haproxy.o\n  CC      src/cache.o\n  CC      src/stconn.o\n  CC      src/http_act.o\n  CC      src/http_fetch.o\n  CC      src/http_client.o\n  CC      src/listener.o\n  CC      src/dns.o\n  CC      src/vars.o\n  CC      src/debug.o\n  CC      src/tcp_rules.o\n  CC      src/sink.o\n  CC      src/h1_htx.o\n  CC      src/task.o\n  CC      src/mjson.o\n  CC      src/h2.o\n  CC      src/filters.o\n  CC      src/server_state.o\n  CC      src/payload.o\n  CC      src/fcgi-app.o\n  CC      src/map.o\n  CC      src/htx.o\n  CC      src/h1.o\n  CC      src/pool.o\n  CC      src/cfgparse-global.o\n  CC      src/trace.o\n  CC      src/tcp_sample.o\n  CC      src/flt_http_comp.o\n  CC      src/mux_pt.o\n  CC      src/flt_trace.o\n  CC      src/mqtt.o\n  CC      src/acl.o\n  CC      src/sock.o\n  CC      src/mworker.o\n  CC      src/tcp_act.o\n  CC      src/ring.o\n  CC      src/session.o\n  CC      src/proto_tcp.o\n  CC      src/fd.o\n  CC      src/channel.o\n  CC      src/activity.o\n  CC      src/queue.o\n  CC      src/lb_fas.o\n  CC      src/http_rules.o\n  CC      src/extcheck.o\n  CC      src/thread.o\n  CC      src/http.o\n  CC      src/lb_chash.o\n  CC      src/applet.o\n  CC      src/compression.o\n  CC      src/raw_sock.o\n  CC      src/ncbuf.o\n  CC      src/frontend.o\n  CC      src/errors.o\n  CC      src/uri_normalizer.o\n  CC      src/http_conv.o\n  CC      src/lb_fwrr.o\n  CC      src/sha1.o\n  CC      src/proto_sockpair.o\n  CC      src/mailers.o\n  CC      src/lb_fwlc.o\n  CC      src/ebmbtree.o\n  CC      src/cfgcond.o\n  CC      src/action.o\n  CC      src/xprt_handshake.o\n  CC      src/protocol.o\n  CC      src/proto_uxst.o\n  CC      src/proto_udp.o\n  CC      src/lb_map.o\n  CC      src/fix.o\n  CC      src/ev_select.o\n  CC      src/arg.o\n  CC      src/sock_inet.o\n  CC      src/mworker-prog.o\n  CC      src/hpack-dec.o\n  CC      src/cfgparse-tcp.o\n  CC      src/sock_unix.o\n  CC      src/shctx.o\n  CC      src/proto_uxdg.o\n  CC      src/fcgi.o\n  CC      src/eb64tree.o\n  CC      src/clock.o\n  CC      src/chunk.o\n  CC      src/cfgdiag.o\n  CC      src/signal.o\n  CC      src/regex.o\n  CC      src/lru.o\n  CC      src/eb32tree.o\n  CC      src/eb32sctree.o\n  CC      src/cfgparse-unix.o\n  CC      src/hpack-tbl.o\n  CC      src/ebsttree.o\n  CC      src/ebimtree.o\n  CC      src/base64.o\n  CC      src/auth.o\n  CC      src/uri_auth.o\n  CC      src/time.o\n  CC      src/ebistree.o\n  CC      src/dynbuf.o\n  CC      src/wdt.o\n  CC      src/pipe.o\n  CC      src/init.o\n  CC      src/http_acl.o\n  CC      src/hpack-huff.o\n  CC      src/hpack-enc.o\n  CC      src/dict.o\n  CC      src/freq_ctr.o\n  CC      src/ebtree.o\n  CC      src/hash.o\n  CC      src/dgram.o\n  CC      src/version.o\n  LD      haproxy\n  CC      dev/flags/flags.o\n  LD      dev/flags/flags\n\n$ make install PREFIX=/usr/local/haproxy\n$ ln -s /usr/local/haproxy/sbin/haproxy /usr/sbin/\n\n\n#\u9a8c\u8bc1\u7248\u672c\n\n[root@localhost haproxy]# haproxy -v\nHAProxy version 2.6.8-ab6ee7f 2023/01/24 - https://haproxy.org/\nStatus: long-term supported branch - will stop receiving fixes around Q2 2027.\nKnown bugs: http://www.haproxy.org/bugs/bugs-2.6.8.html\nRunning on: Linux 3.10.0-1127.8.2.el7.x86_64 #1 SMP Tue May 12 16:57:42 UTC 2020 x86_64\n"})}),"\n",(0,r.jsx)("a",{name:"3d87368c"}),"\n",(0,r.jsx)(o.h4,{id:"323-haproxy\u542f\u52a8\u811a\u672c",children:"3.2.3 HAProxy\u542f\u52a8\u811a\u672c"}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-bash",children:"vim   /usr/lib/systemd/system/haproxy.service\n[Unit]\nDescription=HAProxy Load Balancer\nAfter=syslog.target network.target\n\n[Service]\nExecStartPre=/usr/sbin/haproxy -f /etc/haproxy/haproxy.cfg  -c -q\nExecStart=/usr/sbin/haproxy -Ws -f /etc/haproxy/haproxy.cfg -p /var/lib/haproxy/haproxy.pid\nExecReload=/bin/kill -USR2 $MAINPID\n\n[Install]\nWantedBy=multi-user.target\n"})}),"\n",(0,r.jsx)("a",{name:"ca1a39af"}),"\n",(0,r.jsx)(o.h4,{id:"324-\u521b\u5efa\u914d\u7f6e\u6587\u4ef6",children:"3.2.4 \u521b\u5efa\u914d\u7f6e\u6587\u4ef6"}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-bash",children:"mkdir  /etc/haproxy\nvim /etc/haproxy/haproxy.cfg\n\nglobal\n    maxconn 100000\n    chroot /apps/haproxy\n    stats socket /var/lib/haproxy/haproxy.sock mode 600 level admin\n    #uid 99\n    #gid 99\n    user  haproxy\n    group haproxy\n    daemon\n    #nbproc 4\n    #cpu-map 1 0\n    #cpu-map 2 1\n    #cpu-map 3 2\n    #cpu-map 4 3\n    pidfile /var/lib/haproxy/haproxy.pid\n    log 127.0.0.1 local2 info\n\ndefaults\n    option http-keep-alive\n    option  forwardfor\n    maxconn 100000\n    mode http\n    timeout connect 300000ms\n    timeout client  300000ms\n    timeout server  300000ms\n\nlisten stats\n    mode http\n    bind 0.0.0.0:9999\n    stats enable\n    log global\n    stats uri     /haproxy-status\n    stats auth    haadmin:123456\n\nlisten  web_port\n    bind 10.1.0.6:30013\n    mode http\n    option forwardfor\n    log global\n    server web1  10.1.0.31:30013  check inter 3000 fall 2 rise 5\n"})}),"\n",(0,r.jsx)("a",{name:"8da5a3ae"}),"\n",(0,r.jsx)(o.h4,{id:"325-\u542f\u52a8haproxy",children:"3.2.5 \xa0\u542f\u52a8haproxy"}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-bash",children:"mkdir  /var/lib/haproxy\nchown  -R 99.99 /var/lib/haproxy/ \n\nuseradd -r -s /sbin/nologin -d /var/lib/haproxy haproxy\nsystemctl daemon-reload\n\nsystemctl start haproxy\nsystemctl enable haproxy\nsystemctl status haproxy\n"})}),"\n",(0,r.jsx)("a",{name:"b02a49a0"}),"\n",(0,r.jsx)(o.h3,{id:"33-\u9a8c\u8bc1haproxy\u72b6\u6001",children:"3.3 \u9a8c\u8bc1haproxy\u72b6\u6001"}),"\n",(0,r.jsx)("a",{name:"309825cc"}),"\n",(0,r.jsx)(o.h4,{id:"331-\u9a8c\u8bc1\u76d1\u542c\u7aef\u53e3",children:"3.3.1 \u9a8c\u8bc1\u76d1\u542c\u7aef\u53e3"}),"\n",(0,r.jsx)(o.pre,{children:(0,r.jsx)(o.code,{className:"language-bash",children:"[root@localhost haproxy]# ss -tnl\nState       Recv-Q Send-Q          Local Address:Port      Peer Address:Port              \nLISTEN      0      128                 127.0.0.1:631                  *:*                  \nLISTEN      0      100                         *:8088                 *:*                  \nLISTEN      0      3                   127.0.0.1:31769                *:*                  \nLISTEN      0      100                 127.0.0.1:25                   *:*                  \nLISTEN      0      128                         *:1883                 *:*                  \nLISTEN      0      128                         *:30013                *:*                  \nLISTEN      0      50                          *:8161                 *:*                  \nLISTEN      0      1                   127.0.0.1:8005                 *:*                  \nLISTEN      0      128                         *:5672                 *:*                  \nLISTEN      0      50                          *:43178                *:*                  \nLISTEN      0      128                         *:6379                 *:*                  \nLISTEN      0      128                         *:61613                *:*                  \nLISTEN      0      50                          *:61614                *:*                  \nLISTEN      0      128                         *:9999                 *:*\n"})}),"\n",(0,r.jsx)("a",{name:"af73fc56"}),"\n",(0,r.jsx)(o.h4,{id:"332-\u67e5\u770bhaproxy\u7684\u72b6\u6001\u9875\u9762",children:"3.3.2 \u67e5\u770bhaproxy\u7684\u72b6\u6001\u9875\u9762"}),"\n",(0,r.jsxs)(o.p,{children:["\u6d4f\u89c8\u5668\u8bbf\u95ee\uff1a",(0,r.jsx)(o.a,{href:"http://www.yunweipai.com/go?_=84a56fb1feaHR0cDovL2hhcHJveHktc2VydmVyOjk5OTkvaGFwcm94eS1zdGF0dXM%3D",children:"http://haproxy-server:9999/haproxy-status"}),(0,r.jsx)("br",{}),(0,r.jsx)(o.img,{src:"https://cdn1.ryanxin.live/1676021477593-8a91dd15-dde3-4cc1-a009-f117f39f08f9.png#alt=",alt:""})]}),"\n",(0,r.jsx)("a",{name:"fa61ee46"}),"\n",(0,r.jsx)(o.h4,{id:"333-\u6d4b\u8bd5\u8f6c\u53d1",children:"3.3.3 \u6d4b\u8bd5\u8f6c\u53d1"}),"\n",(0,r.jsx)(o.p,{children:"10.1.0.6:30013 \u8f6c\u53d1\u5230 10.1.0.31:30013 \u2705"}),"\n",(0,r.jsx)(o.p,{children:(0,r.jsx)(o.img,{src:"https://cdn1.ryanxin.live/1676254179452-d15ddfd6-e6e2-4d2c-8d3a-691d48309fcf.png#alt=",alt:""})})]})}function d(n={}){const{wrapper:o}={...(0,a.R)(),...n.components};return o?(0,r.jsx)(o,{...n,children:(0,r.jsx)(u,{...n})}):u(n)}},8453:(n,o,e)=>{e.d(o,{R:()=>c,x:()=>l});var r=e(6540);const a={},s=r.createContext(a);function c(n){const o=r.useContext(s);return r.useMemo((function(){return"function"==typeof n?n(o):{...o,...n}}),[o,n])}function l(n){let o;return o=n.disableParentContext?"function"==typeof n.components?n.components(a):n.components||a:c(n.components),r.createElement(s.Provider,{value:o},n.children)}}}]);