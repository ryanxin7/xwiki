"use strict";(self.webpackChunkxlog=self.webpackChunkxlog||[]).push([[6283],{8907:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>c,contentTitle:()=>i,default:()=>u,frontMatter:()=>s,metadata:()=>o,toc:()=>d});var a=t(4848),r=t(8453);const s={id:"kubeadm-cluster-deployment",title:"Kubeadm \u90e8\u7f72\u96c6\u7fa4",slug:"/KubernetesTraining3/LabEnvironment/kubeadm-cluster-deployment",date:new Date("2024-03-07T10:23:32.000Z")},i="\u4e00\u3001\u96c6\u7fa4\u90e8\u7f72",o={id:"KubernetesTraining3/\u5b9e\u9a8c\u73af\u5883\u90e8\u7f72/kubeadm-cluster-deployment",title:"Kubeadm \u90e8\u7f72\u96c6\u7fa4",description:"\u4f7f\u7528 containerd \u4f5c\u4e3a\u5bb9\u5668\u8fd0\u884c\u65f6\u642d\u5efa Kubernetes \u96c6\u7fa4\u73b0\u5728\u6211\u4eec\u4f7f\u7528 kubeadm \u4ece\u5934\u642d\u5efa\u4e00\u4e2a\u4f7f\u7528 containerd \u4f5c\u4e3a\u5bb9\u5668\u8fd0\u884c\u65f6\u7684 Kubernetes \u96c6\u7fa4\uff0c\u8fd9\u91cc\u6211\u4eec\u5b89\u88c5\u6700\u65b0\u7684 v1.22.2 \u7248\u672c\u3002",source:"@site/src/k8s/KubernetesTraining3/\u5b9e\u9a8c\u73af\u5883\u90e8\u7f72/Kubeadm\u90e8\u7f72\u96c6\u7fa4.md",sourceDirName:"KubernetesTraining3/\u5b9e\u9a8c\u73af\u5883\u90e8\u7f72",slug:"/KubernetesTraining3/LabEnvironment/kubeadm-cluster-deployment",permalink:"/k8s/KubernetesTraining3/LabEnvironment/kubeadm-cluster-deployment",draft:!1,unlisted:!1,editUrl:"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/src/k8s/KubernetesTraining3/\u5b9e\u9a8c\u73af\u5883\u90e8\u7f72/Kubeadm\u90e8\u7f72\u96c6\u7fa4.md",tags:[],version:"current",frontMatter:{id:"kubeadm-cluster-deployment",title:"Kubeadm \u90e8\u7f72\u96c6\u7fa4",slug:"/KubernetesTraining3/LabEnvironment/kubeadm-cluster-deployment",date:"2024-03-07T10:23:32.000Z"},sidebar:"haproxySidebar",previous:{title:"Kubeadm+\u5916\u90e8etcd\u90e8\u7f72\u96c6\u7fa4",permalink:"/k8s/KubernetesTraining3/LabEnvironment/kubeadm-cluster-deployment-etcd"},next:{title:"Tutorial Intro",permalink:"/k8s/intro"}},c={},d=[{value:"1.\u73af\u5883\u51c6\u5907",id:"1\u73af\u5883\u51c6\u5907",level:2},{value:"1.1 \u8bbe\u7f6e\u65f6\u533a",id:"11-\u8bbe\u7f6e\u65f6\u533a",level:3},{value:"1.2 \u5173\u95edufw\u670d\u52a1",id:"12-\u5173\u95edufw\u670d\u52a1",level:3},{value:"1.3 \u5173\u95ed\u4ea4\u6362\u7a7a\u95f4",id:"13-\u5173\u95ed\u4ea4\u6362\u7a7a\u95f4",level:3},{value:"2. \u5185\u6838\u53c2\u6570\u4f18\u5316",id:"2-\u5185\u6838\u53c2\u6570\u4f18\u5316",level:2},{value:"3.\u5b89\u88c5IPVS",id:"3\u5b89\u88c5ipvs",level:2},{value:"\u4e8c\u3001\u5b89\u88c5Containerd",id:"\u4e8c\u5b89\u88c5containerd",level:2},{value:"1\u3001apt \u5b89\u88c5",id:"1apt-\u5b89\u88c5",level:3},{value:"1.1\u3001\u67e5\u770b containerd \u4ed3\u5e93\u7248\u672c",id:"11\u67e5\u770b-containerd-\u4ed3\u5e93\u7248\u672c",level:4},{value:"1.2\u3001\u5b89\u88c5 containerd",id:"12\u5b89\u88c5-containerd",level:4},{value:"<br></br>1.3\u3001\u67e5\u770b containerd service \u6587\u4ef6",id:"13\u67e5\u770b-containerd-service-\u6587\u4ef6",level:4},{value:"1.4\u3001\u9a8c\u8bc1 runc \u73af\u5883",id:"14\u9a8c\u8bc1-runc-\u73af\u5883",level:4},{value:"1.5\u3001containerd \u914d\u7f6e\u6587\u4ef6",id:"15containerd-\u914d\u7f6e\u6587\u4ef6",level:4},{value:"2\u3001\u4e8c\u8fdb\u5236\u5b89\u88c5 containerd",id:"2\u4e8c\u8fdb\u5236\u5b89\u88c5-containerd",level:3},{value:"2.1\u3001\u4e0b\u8f7d containerd \u2f06\u8fdb\u5236\u6587\u4ef6",id:"21\u4e0b\u8f7d-containerd-\u8fdb\u5236\u6587\u4ef6",level:4},{value:"2.2\u3001\u5c06\u538b\u7f29\u5305\u89e3\u538b\u5230\u7cfb\u7edf\u7684\u5404\u4e2a\u76ee\u5f55\u4e2d",id:"22\u5c06\u538b\u7f29\u5305\u89e3\u538b\u5230\u7cfb\u7edf\u7684\u5404\u4e2a\u76ee\u5f55\u4e2d",level:4},{value:"2.3 \u3001\u521b\u5efa containerd service \u6587\u4ef6(cri-containerd-cni\u7248\u672c\u9ed8\u8ba4\u81ea\u5e26\u4e86service\u6587\u4ef6)",id:"23-\u521b\u5efa-containerd-service-\u6587\u4ef6cri-containerd-cni\u7248\u672c\u9ed8\u8ba4\u81ea\u5e26\u4e86service\u6587\u4ef6",level:4},{value:"2.4\u3001\u9a8c\u8bc1runc\u7248\u672c",id:"24\u9a8c\u8bc1runc\u7248\u672c",level:4},{value:"2.5\u3001\u9a8c\u8bc1CNI\u63d2\u4ef6",id:"25\u9a8c\u8bc1cni\u63d2\u4ef6",level:4},{value:"2.6 \u3001containerd \u4f18\u5316",id:"26-containerd-\u4f18\u5316",level:4},{value:"3\u3001containerd \u5ba2\u6237\u7aef\u5de5\u5177\u6269\u5c55",id:"3containerd-\u5ba2\u6237\u7aef\u5de5\u5177\u6269\u5c55",level:3},{value:"3.2 nerdctl \u63a8\u8350\u4f7f\u7528",id:"32-nerdctl-\u63a8\u8350\u4f7f\u7528",level:4},{value:"3.2.1\u3001\u5b89\u88c5 nerdctl",id:"321\u5b89\u88c5-nerdctl",level:5},{value:"3.2.2\u3001nerdctl \u914d\u7f6e\u6587\u4ef6",id:"322nerdctl-\u914d\u7f6e\u6587\u4ef6",level:5},{value:"3.2.3\u3001nerdctl \u4e0b\u8f7d nginx \u955c\u50cf",id:"323nerdctl-\u4e0b\u8f7d-nginx-\u955c\u50cf",level:5},{value:"3.2.4\u3001nerdctl \u521b\u5efa nginx \u5bb9\u5668",id:"324nerdctl-\u521b\u5efa-nginx-\u5bb9\u5668",level:5},{value:"3.2.5\u3001nerdctl \u67e5\u770b nginx \u5bb9\u5668\u65e5\u5fd7",id:"325nerdctl-\u67e5\u770b-nginx-\u5bb9\u5668\u65e5\u5fd7",level:5},{value:"3.2.6\u3001nerdctl \u67e5\u770b\u5bb9\u5668",id:"326nerdctl-\u67e5\u770b\u5bb9\u5668",level:5},{value:"\u4e8c\u3001\u4f7f\u7528 kubeadm \u90e8\u7f72 Kubernetes",id:"\u4e8c\u4f7f\u7528-kubeadm-\u90e8\u7f72-kubernetes",level:2},{value:"2.1 \u5b89\u88c5kubeadm\u3001kubectl\u3001kubelet",id:"21-\u5b89\u88c5kubeadmkubectlkubelet",level:3},{value:"2.2 \u521d\u59cb\u5316\u96c6\u7fa4",id:"22-\u521d\u59cb\u5316\u96c6\u7fa4",level:3},{value:"\u4e09\u3001\u6dfb\u52a0\u8282\u70b9",id:"\u4e09\u6dfb\u52a0\u8282\u70b9",level:2},{value:"3.1\u6dfb\u52a0 node \u8282\u70b9",id:"31\u6dfb\u52a0-node-\u8282\u70b9",level:3},{value:"3.2 \u6dfb\u52a0 master \u8282\u70b9",id:"32-\u6dfb\u52a0-master-\u8282\u70b9",level:3},{value:"\u56db\u3001\u90e8\u7f72\u7f51\u7edc\u7ec4\u4ef6",id:"\u56db\u90e8\u7f72\u7f51\u7edc\u7ec4\u4ef6",level:2},{value:"\u4e94\u3001Dashboard",id:"\u4e94dashboard",level:2},{value:"\u6e05\u7406",id:"\u6e05\u7406",level:2}];function l(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",img:"img",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",...(0,r.R)(),...e.components};return(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("a",{name:"UMkO9"}),"\n",(0,a.jsx)(n.h1,{id:"\u4e00\u96c6\u7fa4\u90e8\u7f72",children:"\u4e00\u3001\u96c6\u7fa4\u90e8\u7f72"}),"\n",(0,a.jsxs)(n.p,{children:["\u4f7f\u7528 containerd \u4f5c\u4e3a\u5bb9\u5668\u8fd0\u884c\u65f6\u642d\u5efa Kubernetes \u96c6\u7fa4",(0,a.jsx)("br",{}),"\u73b0\u5728\u6211\u4eec\u4f7f\u7528 kubeadm \u4ece\u5934\u642d\u5efa\u4e00\u4e2a\u4f7f\u7528 containerd \u4f5c\u4e3a\u5bb9\u5668\u8fd0\u884c\u65f6\u7684 Kubernetes \u96c6\u7fa4\uff0c\u8fd9\u91cc\u6211\u4eec\u5b89\u88c5\u6700\u65b0\u7684 v1.22.2 \u7248\u672c\u3002"]}),"\n",(0,a.jsxs)(n.p,{children:["\u53c2\u8003\uff1a",(0,a.jsx)(n.a,{href:"https://www.cnblogs.com/tingfengdengyu/articles/17336942.html",children:"https://www.cnblogs.com/tingfengdengyu/articles/17336942.html"}),(0,a.jsx)("br",{}),"          ",(0,a.jsx)(n.a,{href:"https://www.cnblogs.com/khtt/p/17139972.html",children:"https://www.cnblogs.com/khtt/p/17139972.html"})]}),"\n",(0,a.jsx)("a",{name:"HuZbE"}),"\n",(0,a.jsx)(n.h2,{id:"1\u73af\u5883\u51c6\u5907",children:"1.\u73af\u5883\u51c6\u5907"}),"\n",(0,a.jsx)(n.p,{children:"3 \u4e2a\u8282\u70b9\uff0c\u90fd\u662f Ubuntu20.04\u7cfb\u7edf\uff0c\u5728\u6bcf\u4e2a\u8282\u70b9\u4e0a\u6dfb\u52a0 hosts \u4fe1\u606f\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"tee -a /etc/hosts<<EOF\n192.168.10.90 master01\n192.168.10.91 node01\n192.168.10.92 node02\nEOF\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"\nmv /etc/apt/sources.list{,.bak}\n\ntee  /etc/apt/sources.list<<EOF\ndeb http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ focal main restricted universe multiverse\n\ndeb http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ focal-security main restricted universe multiverse\n\ndeb http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ focal-updates main restricted universe multiverse\n\n# deb http://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse\n# deb-src http://mirrors.aliyun.com/ubuntu/ focal-proposed main restricted universe multiverse\n\ndeb http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse\ndeb-src http://mirrors.aliyun.com/ubuntu/ focal-backports main restricted universe multiverse\nEOF\n\ntee  /etc/apt/sources.list<<EOF\n# \u9ed8\u8ba4\u6ce8\u91ca\u4e86\u6e90\u7801\u955c\u50cf\u4ee5\u63d0\u9ad8 apt update \u901f\u5ea6\uff0c\u5982\u6709\u9700\u8981\u53ef\u81ea\u884c\u53d6\u6d88\u6ce8\u91ca\ndeb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic main restricted universe multiverse\n# deb-src http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic main restricted universe multiverse\ndeb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse\n# deb-src http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse\ndeb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse\n# deb-src http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse\n\ndeb http://security.ubuntu.com/ubuntu/ bionic-security main restricted universe multiverse\n# deb-src http://security.ubuntu.com/ubuntu/ bionic-security main restricted universe multiverse\n\n# \u9884\u53d1\u5e03\u8f6f\u4ef6\u6e90\uff0c\u4e0d\u5efa\u8bae\u542f\u7528\n# deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse\n# # deb-src http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse\nEOF\n\n#\u66f4\u65b0\u4ed3\u5e93\napt update\n"})}),"\n",(0,a.jsx)("a",{name:"IyQ4z"}),"\n",(0,a.jsx)(n.h3,{id:"11-\u8bbe\u7f6e\u65f6\u533a",children:"1.1 \u8bbe\u7f6e\u65f6\u533a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"#\u65f6\u533a\n timedatectl set-timezone Asia/Shanghai\n\n#\u65f6\u95f4\u540c\u6b65\napt install chrony -y\nsudo sed -i 's/ntp.ubuntu.com/ntp.aliyun.com/g' /etc/chrony/chrony.conf\nsystemctl restart chrony && systemctl enable chrony\n\necho \"*/3 * * * * /usr/sbin/chronyc makestep\" | sudo tee -a /etc/crontab\n\n\n#selinux\n~ cat /etc/selinux/config\nSELINUX=disabled\n#ubuntu \u6ca1\u6709\u5b89\u88c5selinux\n\n\n# Ubuntu\u5b89\u5168\u8f6f\u4ef6\u7684\u9650\u5236\uff0c\u53ef\u80fd\u5bfc\u81f4\u8282\u70b9\u5904\u4e8enotReady\u72b6\u6001\uff0c\u6240\u4ee5\u9700\u8981\u5173\u95ed\n# \u505c\u6b62\u5b89\u5168\u5e94\u7528 apparmor\nsystemctl stop apparmor\n# \u7981\u7528\u5b89\u5168\u9650\u5236\nsystemctl disable apparmor\n"})}),"\n",(0,a.jsx)("a",{name:"An4un"}),"\n",(0,a.jsx)(n.h3,{id:"12-\u5173\u95edufw\u670d\u52a1",children:"1.2 \u5173\u95edufw\u670d\u52a1"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# \u5173\u95edufw\u670d\u52a1\nsystemctl stop ufw && systemctl disable ufw\n# \u5173\u95ediptables\u670d\u52a1\nsystemctl stop iptables\nsystemctl disable iptables\n"})}),"\n",(0,a.jsx)("a",{name:"GDkDv"}),"\n",(0,a.jsx)(n.h3,{id:"13-\u5173\u95ed\u4ea4\u6362\u7a7a\u95f4",children:"1.3 \u5173\u95ed\u4ea4\u6362\u7a7a\u95f4"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"## \u5173\u95ed\u4ea4\u6362\u7a7a\u95f4\nsudo swapoff -a  \n# \u6c38\u4e45\u7981\u7528\u3002-i \u63d2\u5165\u4fee\u6539\u6a21\u5f0f\uff0cg \u6807\u8bc6\u7b26\u8868\u793a\u5168\u5c40\u67e5\u627e\u66ff\u6362,\u8868\u793a\u6ce8\u91ca\u6389swap\u7684\u90a3\u4e00\u884c\u3002\nsudo sed -i '/swap/ s/^/#/g' /etc/fstab\n# \u67e5\u770b\u7981\u7528\u72b6\u6001\nfree -h \n"})}),"\n",(0,a.jsx)("a",{name:"VdIb7"}),"\n",(0,a.jsx)(n.h2,{id:"2-\u5185\u6838\u53c2\u6570\u4f18\u5316",children:"2. \u5185\u6838\u53c2\u6570\u4f18\u5316"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"#\u5f00\u542f\u5185\u6838\u6a21\u5757\nmodprobe nf_conntrack && modprobe br_netfilter\n\n\n\n#\u914d\u7f6e\u5185\u6838\u53c2\u6570\nsudo tee /etc/sysctl.d/kubernetes.conf<<EOF\nnet.ipv4.ip_forward = 1\nvm.max_map_count = 262144\nkernel.pid_max = 4194303\nfs.file-max = 1000000\nnet.ipv4.tcp_max_tw_buckets = 6000\nnet.ipv4.tcp_keepalive_intvl = 30\nnet.ipv4.tcp_keepalive_probes = 10\nnet.ipv4.tcp_keepalive_time = 600\nnet.netfilter.nf_conntrack_max = 2097152\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nvm.swappiness = 0\nEOF\n\n# \u91cd\u65b0\u52a0\u8f7d\u914d\u7f6e\nsysctl -p /etc/sysctl.d/kubernetes.conf\nnet.ipv4.ip_forward = 1\nvm.max_map_count = 262144\nkernel.pid_max = 4194303\nfs.file-max = 1000000\nnet.ipv4.tcp_max_tw_buckets = 6000\nnet.ipv4.tcp_keepalive_intvl = 30\nnet.ipv4.tcp_keepalive_probes = 10\nnet.ipv4.tcp_keepalive_time = 600\nnet.netfilter.nf_conntrack_max = 2097152\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.bridge.bridge-nf-call-iptables = 1\nvm.swappiness = 0\n\n\n#\u6dfb\u52a0\u5185\u6838\u6a21\u5757\u5f00\u673a\u6302\u8f7d\n\nsudo tee -a /etc/modules-load.d/modules.conf<<EOF\nip_vs\nip_vs_lc\nip_vs_lblc\nip_vs_lblcr\nip_vs_rr\nip_vs_wrr\nip_vs_sh\nip_vs_dh\nip_vs_fo\nip_vs_nq\nip_vs_sed\nip_vs_ftp\nip_vs_sh\nip_tables\nip_set\nipt_set\nipt_rpfilter\nipt_REJECT\nipip\nxt_set\nbr_netfilter\nnf_conntrack\noverlay\nEOF\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"#\u91cd\u542f\u540e\u9a8c\u8bc1\u5185\u6838\u6a21\u5757\u4e0e\u5185\u5b58\u53c2\u6570\n\nreboot\n\nlsmod | grep br_netfilter\nbr_netfilter           28672  0\nbridge                176128  1 br_netfilter\n\n\nsysctl -a | grep bridge-nf-call-iptables\nnet.bridge.bridge-nf-call-iptables = 1\n"})}),"\n",(0,a.jsx)("a",{name:"M9EOI"}),"\n",(0,a.jsx)(n.h2,{id:"3\u5b89\u88c5ipvs",children:"3.\u5b89\u88c5IPVS"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"apt install ipset ipvsadm -y\n\n#\u9a8c\u8bc1\nlsmod | grep -e ip_vs -e nf_conntrack \n\nip_vs_ftp              16384  0\nnf_nat                 49152  2 openvswitch,ip_vs_ftp\nip_vs_sed              16384  0\nip_vs_nq               16384  0\nip_vs_fo               16384  0\nip_vs_dh               16384  0\nip_vs_sh               16384  0\nip_vs_wrr              16384  0\nip_vs_rr               16384  0\nip_vs_lblcr            16384  0\nip_vs_lblc             16384  0\nip_vs_lc               16384  0\nip_vs                 176128  22 ip_vs_rr,ip_vs_dh,ip_vs_lblcr,ip_vs_sh,ip_vs_fo,ip_vs_nq,ip_vs_lblc,ip_vs_wrr,ip_vs_lc,ip_vs_sed,ip_vs_ftp\nnf_conntrack          172032  4 nf_nat,openvswitch,nf_conncount,ip_vs\nnf_defrag_ipv6         24576  3 nf_conntrack,openvswitch,ip_vs\nnf_defrag_ipv4         16384  1 nf_conntrack\nlibcrc32c              16384  6 nf_conntrack,nf_nat,openvswitch,btrfs,raid456,ip_vs\n"})}),"\n",(0,a.jsx)("a",{name:"sLiJY"}),"\n",(0,a.jsx)(n.h2,{id:"\u4e8c\u5b89\u88c5containerd",children:"\u4e8c\u3001\u5b89\u88c5Containerd"}),"\n",(0,a.jsx)(n.p,{children:"\u4e09\u4e2a\u7248\u672c\u533a\u522b"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:"https://cdn.nlark.com/yuque/0/2024/png/33538388/1709261598317-433ae6be-a533-436d-b265-1fe2daa05e55.png#averageHue=%230f151e&clientId=u75d1ed6a-2085-4&from=paste&height=789&id=u0d7d4c05&originHeight=789&originWidth=1202&originalType=binary&ratio=1&rotation=0&showTitle=false&size=147126&status=done&style=none&taskId=u6691f804-0454-41ba-b7b2-21f452481ee&title=&width=1202",alt:"image.png"})}),"\n",(0,a.jsx)("a",{name:"bDfMw"}),"\n",(0,a.jsx)(n.h3,{id:"1apt-\u5b89\u88c5",children:"1\u3001apt \u5b89\u88c5"}),"\n",(0,a.jsx)("a",{name:"spyUu"}),"\n",(0,a.jsx)(n.h4,{id:"11\u67e5\u770b-containerd-\u4ed3\u5e93\u7248\u672c",children:"1.1\u3001\u67e5\u770b containerd \u4ed3\u5e93\u7248\u672c"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"root@master1:~# apt-cache madison containerd\ncontainerd | 1.7.2-0ubuntu1~22.04.1 | http://mirrors.aliyun.com/ubuntu jammy-updates/main amd64 Packages\ncontainerd | 1.6.12-0ubuntu1~22.04.3 | http://mirrors.aliyun.com/ubuntu jammy-security/main amd64 Packages\ncontainerd | 1.5.9-0ubuntu3 | http://mirrors.aliyun.com/ubuntu jammy/main amd64 Packages\n"})}),"\n",(0,a.jsx)("a",{name:"jatp0"}),"\n",(0,a.jsx)(n.h4,{id:"12\u5b89\u88c5-containerd",children:"1.2\u3001\u5b89\u88c5 containerd"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"apt install -y containerd=1.6.12-0ubuntu1~22.04.1\n"})}),"\n",(0,a.jsx)("a",{name:"YosYi"}),"\n",(0,a.jsxs)(n.h4,{id:"13\u67e5\u770b-containerd-service-\u6587\u4ef6",children:[(0,a.jsx)("br",{}),"1.3\u3001\u67e5\u770b containerd service \u6587\u4ef6"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:' cat /lib/systemd/system/containerd.service\n# Copyright The containerd Authors.\n#\n# Licensed under the Apache License, Version 2.0 (the "License");\n# you may not use this file except in compliance with the License.\n# You may obtain a copy of the License at\n#\n#     http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an "AS IS" BASIS,\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n# See the License for the specific language governing permissions and\n# limitations under the License.\n\n[Unit]\nDescription=containerd container runtime\nDocumentation=https://containerd.io\nAfter=network.target local-fs.target\n\n[Service]\nExecStartPre=-/sbin/modprobe overlay\nExecStart=/usr/bin/containerd\n\nType=notify\nDelegate=yes\nKillMode=process\nRestart=always\nRestartSec=5\n# Having non-zero Limit*s causes performance problems due to accounting overhead\n# in the kernel. We recommend using cgroups to do container-local accounting.\nLimitNPROC=infinity\nLimitCORE=infinity\nLimitNOFILE=infinity\n# Comment TasksMax if your systemd version does not supports it.\n# Only systemd 226 and above support this version.\nTasksMax=infinity\nOOMScoreAdjust=-999\n\n[Install]\nWantedBy=multi-user.target\n'})}),"\n",(0,a.jsx)("a",{name:"y5AKL"}),"\n",(0,a.jsx)(n.h4,{id:"14\u9a8c\u8bc1-runc-\u73af\u5883",children:"1.4\u3001\u9a8c\u8bc1 runc \u73af\u5883"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"root@containerd-server:~# whereis runc\nrunc: /usr/sbin/runc\nroot@containerd-server:~# whereis containerd\ncontainerd: /usr/bin/containerd\nroot@containerd-server:~# runc -v\nrunc version 1.1.4-0ubuntu1~22.04.1\nspec: 1.0.2-dev\ngo: go1.18.1\nlibseccomp: 2.5.3\nroot@containerd-server:~# containerd -v\ncontainerd github.com/containerd/containerd 1.6.12-0ubuntu1~22.04.1\n"})}),"\n",(0,a.jsx)("a",{name:"C6pXW"}),"\n",(0,a.jsx)(n.h4,{id:"15containerd-\u914d\u7f6e\u6587\u4ef6",children:"1.5\u3001containerd \u914d\u7f6e\u6587\u4ef6"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"#\u67e5\u770b containerd \u9ed8\u8ba4\u914d\u7f6e\nroot@containerd-server:~# containerd config default\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"#\u521b\u5efa containerd \u914d\u7f6e\u6587\u4ef6\nroot@containerd-server:~# mkdir /etc/containerd\nroot@containerd-server:~# containerd config default > /etc/containerd/config.toml\nroot@containerd-server:~# systemctl restart containerd.service\n"})}),"\n",(0,a.jsx)("a",{name:"jUhzZ"}),"\n",(0,a.jsx)(n.h3,{id:"2\u4e8c\u8fdb\u5236\u5b89\u88c5-containerd",children:"2\u3001\u4e8c\u8fdb\u5236\u5b89\u88c5 containerd"}),"\n",(0,a.jsxs)(n.p,{children:["\u901a\u8fc7\u5b98\u2f45\u2f06\u8fdb\u5236\u5b89\u88c5 containerd\u3001runc \u53ca CNI\uff0ckubernetes \u4ece v1.24.0 \u5f00\u59cb\u9ed8\u8ba4\u4f7f\u2f64 containerd \u4f5c\u4e3a\u5bb9\u5668\u8fd0\u2f8f\u65f6\uff0c\u56e0\u6b64\u9700\u8981\u63d0\u524d\u5b89\u88c5\u597d containerd \u4e4b\u540e\u5728\u5b89\u88c5 v1.24 \u6216\u66f4\u2fbc\u7248\u672c\u7684 kubernetes \uff08\u5982\u679c\u8981\u7ee7\u7eed\u4f7f\u2f64 docker\uff0c\u5219\u9700\u8981\u5355\u72ec\u5b89\u88c5 docker \u53ca cri-dockerd\uff0c",(0,a.jsx)(n.a,{href:"https://github.com/Mirantis/cri-dockerd",children:"https://github.com/Mirantis/cri-dockerd"})," \uff09"]}),"\n",(0,a.jsx)("a",{name:"gJjED"}),"\n",(0,a.jsx)(n.h4,{id:"21\u4e0b\u8f7d-containerd-\u8fdb\u5236\u6587\u4ef6",children:"2.1\u3001\u4e0b\u8f7d containerd \u2f06\u8fdb\u5236\u6587\u4ef6"}),"\n",(0,a.jsxs)(n.p,{children:["containerd v1.6.24 \u4e0b\u8f7d\u5730\u5740\uff1a",(0,a.jsx)(n.a,{href:"https://github.com/containerd/containerd/releases/tag/v1.6.24",children:"https://github.com/containerd/containerd/releases/tag/v1.6.24"})]}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)(n.img,{src:"https://cdn.nlark.com/yuque/0/2024/png/33538388/1709261325943-924c5791-f482-4726-bf1b-310bfbd06e01.png#averageHue=%23dcb667&clientId=u75d1ed6a-2085-4&from=paste&height=572&id=LcDAZ&originHeight=572&originWidth=917&originalType=binary&ratio=1&rotation=0&showTitle=false&size=89067&status=done&style=none&taskId=u1ad3d23a-95d1-436f-8b94-ecf8e6285a3&title=&width=917",alt:"image.png"}),(0,a.jsx)("br",{}),(0,a.jsx)(n.img,{src:"https://cdn.nlark.com/yuque/0/2024/png/33538388/1709261416899-c1aec674-1776-4f86-b4e0-a3e121769d1f.png#averageHue=%23d9b268&clientId=u75d1ed6a-2085-4&from=paste&height=568&id=igvm3&originHeight=568&originWidth=915&originalType=binary&ratio=1&rotation=0&showTitle=false&size=74743&status=done&style=none&taskId=u30746706-fd14-4e65-9d27-f9416ce8a6a&title=&width=915",alt:"image.png"})]}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"https://www.cnblogs.com/tingfengdengyu/articles/17336942.html",children:"https://www.cnblogs.com/tingfengdengyu/articles/17336942.html"})}),"\n",(0,a.jsx)("a",{name:"LiWp3"}),"\n",(0,a.jsx)(n.h4,{id:"22\u5c06\u538b\u7f29\u5305\u89e3\u538b\u5230\u7cfb\u7edf\u7684\u5404\u4e2a\u76ee\u5f55\u4e2d",children:"2.2\u3001\u5c06\u538b\u7f29\u5305\u89e3\u538b\u5230\u7cfb\u7edf\u7684\u5404\u4e2a\u76ee\u5f55\u4e2d"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"tar -C / -zxf cri-containerd-cni-1.6.24-linux-amd64.tar.gz\n\nroot@master1:/k8s-data# ll /usr/local/bin/\ntotal 260304\ndrwxr-xr-x  2 root root     4096 Sep 14 07:11 ./\ndrwxr-xr-x 10 root root     4096 Sep 14 07:08 ../\n-rwxr-xr-x  1 root root 52621816 Sep 14 07:08 containerd*\n-rwxr-xr-x  1 root root  7462912 Sep 14 07:08 containerd-shim*\n-rwxr-xr-x  1 root root  9576448 Sep 14 07:08 containerd-shim-runc-v1*\n-rwxr-xr-x  1 root root  9605120 Sep 14 07:08 containerd-shim-runc-v2*\n-rwxr-xr-x  1 root root 23306488 Sep 14 07:08 containerd-stress*\n-rwxr-xr-x  1 root root 54137463 Sep 14 07:10 crictl*\n-rwxr-xr-x  1 root root 56286175 Sep 14 07:10 critest*\n-rwxr-xr-x  1 root root 26232112 Sep 14 07:11 ctd-decoder*\n-rwxr-xr-x  1 root root 27296312 Sep 14 07:08 ctr*\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"#\u9a8c\u8bc1 containerd \u6267\u884c\u7ed3\u679c\ncontainerd -v\ncontainerd github.com/containerd/containerd v1.6.24 61f9fd88f79f081d64d6fa3bb1a0dc71ec870523\n"})}),"\n",(0,a.jsx)("a",{name:"tk4P9"}),"\n",(0,a.jsx)(n.h4,{id:"23-\u521b\u5efa-containerd-service-\u6587\u4ef6cri-containerd-cni\u7248\u672c\u9ed8\u8ba4\u81ea\u5e26\u4e86service\u6587\u4ef6",children:"2.3 \u3001\u521b\u5efa containerd service \u6587\u4ef6(cri-containerd-cni\u7248\u672c\u9ed8\u8ba4\u81ea\u5e26\u4e86service\u6587\u4ef6)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'cat > /lib/systemd/system/containerd.service << EOF\n# Copyright The containerd Authors.\n#\n# Licensed under the Apache License, Version 2.0 (the "License");\n# you may not use this file except in compliance with the License.\n# You may obtain a copy of the License at\n#\n#     http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an "AS IS" BASIS,\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n# See the License for the specific language governing permissions and\n# limitations under the License.\n\n[Unit]\nDescription=containerd container runtime\nDocumentation=https://containerd.io\nAfter=network.target local-fs.target\n\n[Service]\nExecStartPre=-/sbin/modprobe overlay\nExecStart=/usr/bin/containerd\n\nType=notify\nDelegate=yes\nKillMode=process\nRestart=always\nRestartSec=5\n# Having non-zero Limit*s causes performance problems due to accounting overhead\n# in the kernel. We recommend using cgroups to do container-local accounting.\nLimitNPROC=infinity\nLimitCORE=infinity\nLimitNOFILE=infinity\n# Comment TasksMax if your systemd version does not supports it.\n# Only systemd 226 and above support this version.\nTasksMax=infinity\nOOMScoreAdjust=-999\n\n[Install]\nWantedBy=multi-user.target\nEOF\n'})}),"\n",(0,a.jsx)(n.p,{children:"2.4 \u3001\u542f\u52a8containerd \u670d\u52a1"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'#\u8fd0\u884c containerd \u670d\u52a1\uff0c\u5e76\u8bbe\u7f6e\u5f00\u673a\u542f\u52a8\n\nsystemctl daemon-reload\nsystemctl start containerd && systemctl enable containerd.service\nCreated symlink /etc/systemd/system/multi-user.target.wants/containerd.service \u2192 /etc/systemd                                                                             /system/containerd.service.\n\n------------------------------------------------------------\nroot@master1:/k8s-data# systemctl status containerd.service\n\u25cf containerd.service - containerd container runtime\n     Loaded: loaded (/etc/systemd/system/containerd.service; enabled; vendor preset: enabled)\n     Active: active (running) since Fri 2024-03-01 11:03:52 CST; 1min 33s ago\n       Docs: https://containerd.io\n   Main PID: 12483 (containerd)\n      Tasks: 9\n     Memory: 13.2M\n        CPU: 681ms\n     CGroup: /system.slice/containerd.service\n             \u2514\u250012483 /usr/local/bin/containerd\n\nMar 01 11:03:52 master1 containerd[12483]: time="2024-03-01T11:03:52.177386467+08:00" level=info msg=serving... address=/run/containerd/containerd.sock.ttrpc\nMar 01 11:03:52 master1 containerd[12483]: time="2024-03-01T11:03:52.177620799+08:00" level=info msg=serving... address=/run/containerd/containerd.sock\nMar 01 11:03:52 master1 containerd[12483]: time="2024-03-01T11:03:52.177765803+08:00" level=info msg="Start subscribing containerd event"\nMar 01 11:03:52 master1 containerd[12483]: time="2024-03-01T11:03:52.177999021+08:00" level=info msg="Start recovering state"\nMar 01 11:03:52 master1 containerd[12483]: time="2024-03-01T11:03:52.178255615+08:00" level=info msg="Start event monitor"\nMar 01 11:03:52 master1 containerd[12483]: time="2024-03-01T11:03:52.178465109+08:00" level=info msg="Start snapshots syncer"\nMar 01 11:03:52 master1 containerd[12483]: time="2024-03-01T11:03:52.178612046+08:00" level=info msg="Start cni network conf syncer for default"\nMar 01 11:03:52 master1 containerd[12483]: time="2024-03-01T11:03:52.178718637+08:00" level=info msg="Start streaming server"\nMar 01 11:03:52 master1 systemd[1]: Started containerd container runtime.\nMar 01 11:03:52 master1 containerd[12483]: time="2024-03-01T11:03:52.180878526+08:00" level=info msg="containerd successfully booted in 0.035290s"\n\n'})}),"\n",(0,a.jsx)("a",{name:"e97kX"}),"\n",(0,a.jsx)(n.h4,{id:"24\u9a8c\u8bc1runc\u7248\u672c",children:"2.4\u3001\u9a8c\u8bc1runc\u7248\u672c"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"#\u67e5\u770brunc\u7248\u672c\nrunc -v\n--------------------------\nrunc version 1.1.9\ncommit: v1.1.9-0-gccaecfcb\nspec: 1.0.2-dev\ngo: go1.20.8\nlibseccomp: 2.5.3\n"})}),"\n",(0,a.jsx)("a",{name:"rwWQn"}),"\n",(0,a.jsx)(n.h4,{id:"25\u9a8c\u8bc1cni\u63d2\u4ef6",children:"2.5\u3001\u9a8c\u8bc1CNI\u63d2\u4ef6"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"#\u67e5\u770bCNI\u63d2\u4ef6\nls /opt/cni/bin/\nbandwidth  dhcp      host-device  ipvlan    macvlan  ptp  static  vlan\nbridge     firewall  host-local   loopback  portmap  sbr  tuning  vrf\n"})}),"\n",(0,a.jsxs)(n.p,{children:["containerd \u7684\u9ed8\u8ba4\u914d\u7f6e\u6587\u4ef6\u4e3a",(0,a.jsx)(n.code,{children:" /etc/containerd/config.toml"}),"\uff0c\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u5982\u4e0b\u6240\u793a\u7684\u547d\u4ee4\u751f\u6210\u4e00\u4e2a\u9ed8\u8ba4\u7684\u914d\u7f6e\uff1a"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"mkdir -p /etc/containerd\ncontainerd config default > /etc/containerd/config.toml\n"})}),"\n",(0,a.jsx)("a",{name:"S4lGn"}),"\n",(0,a.jsx)(n.h4,{id:"26-containerd-\u4f18\u5316",children:"2.6 \u3001containerd \u4f18\u5316"}),"\n",(0,a.jsxs)(n.p,{children:["\u5bf9\u4e8e\u4f7f\u7528 systemd \u4f5c\u4e3a init system \u7684 Linux \u7684\u53d1\u884c\u7248\uff0c\u4f7f\u7528 systemd \u4f5c\u4e3a\u5bb9\u5668\u7684 cgroup driver \u53ef\u4ee5\u786e\u4fdd\u8282\u70b9\u5728\u8d44\u6e90\u7d27\u5f20\u7684\u60c5\u51b5\u66f4\u52a0\u7a33\u5b9a\uff0c\u6240\u4ee5\u63a8\u8350\u5c06 containerd \u7684 cgroup driver \u914d\u7f6e\u4e3a ",(0,a.jsx)(n.strong,{children:"systemd"}),"\u3002"]}),"\n",(0,a.jsxs)(n.p,{children:["\u4fee\u6539\u524d\u9762\u751f\u6210\u7684\u914d\u7f6e\u6587\u4ef6 ",(0,a.jsx)(n.code,{children:"/etc/containerd/config.toml"}),"\uff0c\u5728 ",(0,a.jsx)(n.code,{children:'plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc.options'})," \u914d\u7f6e\u5757\u4e0b\u9762\u5c06 SystemdCgroup \u8bbe\u7f6e\u4e3a ",(0,a.jsx)(n.code,{children:"true"}),"\uff1a"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'[plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]\n  ...\n  [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc.options]\n    SystemdCgroup = true\n    ....\n'})}),"\n",(0,a.jsxs)(n.p,{children:["\u7136\u540e\u518d\u4e3a\u955c\u50cf\u4ed3\u5e93\u914d\u7f6e\u4e00\u4e2a\u52a0\u901f\u5668\uff0c\u9700\u8981\u5728 cri \u914d\u7f6e\u5757\u4e0b\u9762\u7684 registry \u914d\u7f6e\u5757\u4e0b\u9762\u8fdb\u884c\u914d\u7f6e ",(0,a.jsx)(n.code,{children:"registry.mirrors"}),"\uff1a"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'[plugins."io.containerd.grpc.v1.cri"]\n  ...\n  # sandbox_image = "k8s.gcr.io/pause:3.6"\n  sandbox_image = "registry.cn-hangzhou.aliyuncs.com/xxk8s/pause:3.6"\n  ...\n  [plugins."io.containerd.grpc.v1.cri".registry]\n    [plugins."io.containerd.grpc.v1.cri".registry.mirrors]\n      [plugins."io.containerd.grpc.v1.cri".registry.mirrors."docker.io"]\n        endpoint = ["https://9916w1ow.mirror.aliyuncs.com"]\n      [plugins."io.containerd.grpc.v1.cri".registry.mirrors."k8s.gcr.io"]\n        endpoint = ["https://registry.aliyuncs.com/k8sxio"]\n'})}),"\n",(0,a.jsxs)(n.p,{children:["\u7531\u4e8e\u4e0a\u9762\u6211\u4eec\u4e0b\u8f7d\u7684 containerd \u538b\u7f29\u5305\u4e2d\u5305\u542b\u4e00\u4e2a ",(0,a.jsx)(n.code,{children:"etc/systemd/system/containerd.service"})," \u7684\u6587\u4ef6\uff0c\u8fd9\u6837\u6211\u4eec\u5c31\u53ef\u4ee5\u901a\u8fc7 systemd \u6765\u914d\u7f6e containerd \u4f5c\u4e3a\u5b88\u62a4\u8fdb\u7a0b\u8fd0\u884c\u4e86\uff0c\u73b0\u5728\u6211\u4eec\u5c31\u53ef\u4ee5\u542f\u52a8 containerd \u4e86\uff0c\u76f4\u63a5\u6267\u884c\u4e0b\u9762\u7684\u547d\u4ee4\u5373\u53ef\uff1a"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'systemctl daemon-reload\nsystemctl restart containerd\nsystemctl enable containerd.service\n\nroot@node1:~# systemctl status containerd.service\n\u25cf containerd.service - containerd container runtime\n     Loaded: loaded (/etc/systemd/system/containerd.service; enabled; vendor preset: enabled)\n     Active: active (running) since Mon 2024-03-04 16:49:48 CST; 11s ago\n       Docs: https://containerd.io\n    Process: 5208 ExecStartPre=/sbin/modprobe overlay (code=exited, status=0/SUCCESS)\n   Main PID: 5209 (containerd)\n      Tasks: 9\n     Memory: 12.6M\n        CPU: 117ms\n     CGroup: /system.slice/containerd.service\n             \u2514\u25005209 /usr/local/bin/containerd\n\nMar 04 16:49:48 node1 containerd[5209]: time="2024-03-04T16:49:48.058205051+08:00" level=info msg=serving... address=/run/containerd/containerd.sock.ttrpc\nMar 04 16:49:48 node1 containerd[5209]: time="2024-03-04T16:49:48.058480299+08:00" level=info msg=serving... address=/run/containerd/containerd.sock\nMar 04 16:49:48 node1 containerd[5209]: time="2024-03-04T16:49:48.058656802+08:00" level=info msg="Start subscribing containerd event"\nMar 04 16:49:48 node1 containerd[5209]: time="2024-03-04T16:49:48.058883539+08:00" level=info msg="Start recovering state"\nMar 04 16:49:48 node1 containerd[5209]: time="2024-03-04T16:49:48.059128801+08:00" level=info msg="Start event monitor"\nMar 04 16:49:48 node1 containerd[5209]: time="2024-03-04T16:49:48.059277420+08:00" level=info msg="Start snapshots syncer"\nMar 04 16:49:48 node1 containerd[5209]: time="2024-03-04T16:49:48.059394571+08:00" level=info msg="Start cni network conf syncer for default"\nMar 04 16:49:48 node1 containerd[5209]: time="2024-03-04T16:49:48.059502144+08:00" level=info msg="Start streaming server"\nMar 04 16:49:48 node1 systemd[1]: Started containerd container runtime.\nMar 04 16:49:48 node1 containerd[5209]: time="2024-03-04T16:49:48.062164748+08:00" level=info msg="containerd successfully booted in 0.037756s"\n\n'})}),"\n",(0,a.jsx)(n.p,{children:"\u542f\u52a8\u5b8c\u6210\u540e\u5c31\u53ef\u4ee5\u4f7f\u7528 containerd \u7684\u672c\u5730 CLI \u5de5\u5177 ctr \u548c crictl \u4e86\uff0c\u6bd4\u5982\u67e5\u770b\u7248\u672c\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"ctr version\nClient:\n  Version:  v1.6.24\n  Revision: 61f9fd88f79f081d64d6fa3bb1a0dc71ec870523\n  Go version: go1.20.8\n\nServer:\n  Version:  v1.6.24\n  Revision: 61f9fd88f79f081d64d6fa3bb1a0dc71ec870523\n  UUID: 2179335a-2598-4205-94df-6d8150c97c16\n\n----------------------------------------------------\ncrictl version\nVersion:  0.1.0\nRuntimeName:  containerd\nRuntimeVersion:  v1.6.24\nRuntimeApiVersion:  v1\n"})}),"\n",(0,a.jsx)("a",{name:"CL6jU"}),"\n",(0,a.jsx)(n.h3,{id:"3containerd-\u5ba2\u6237\u7aef\u5de5\u5177\u6269\u5c55",children:"3\u3001containerd \u5ba2\u6237\u7aef\u5de5\u5177\u6269\u5c55"}),"\n",(0,a.jsx)("a",{name:"fBnN1"}),"\n",(0,a.jsx)(n.h4,{id:"32-nerdctl-\u63a8\u8350\u4f7f\u7528",children:"3.2 nerdctl \u63a8\u8350\u4f7f\u7528"}),"\n",(0,a.jsxs)(n.p,{children:["\u5b98\u65b9\u5730\u5740\uff1a",(0,a.jsx)(n.a,{href:"https://github.com/containerd/nerdctl",children:"https://github.com/containerd/nerdctl"})]}),"\n",(0,a.jsx)("a",{name:"jS0Dd"}),"\n",(0,a.jsx)(n.h5,{id:"321\u5b89\u88c5-nerdctl",children:"3.2.1\u3001\u5b89\u88c5 nerdctl"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.a,{href:"https://github.com/containerd/nerdctl/releases/download/v1.7.4/nerdctl-1.7.4-linux-amd64.tar.gz",children:"https://github.com/containerd/nerdctl/releases/download/v1.7.4/nerdctl-1.7.4-linux-amd64.tar.gz"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'tar xfv nerdctl-1.7.4-linux-amd64.tar.gz -C /usr/bin/\nnerdctl\ncontainerd-rootless-setuptool.sh\ncontainerd-rootless.sh\n\n\n------------------------------------\nroot@k8s-master-1:~# nerdctl version\nWARN[0000] unable to determine buildctl version: exec: "buildctl": executable file not found in $PATH \nClient:\n Version:\tv1.3.0\n OS/Arch:\tlinux/amd64\n Git commit:\tc6ddd63dea9aa438fdb0587c0d3d9ae61a60523e\n buildctl:\n  Version:\t\n\nServer:\n containerd:\n  Version:\tv1.6.20\n  GitCommit:\t2806fc1057397dbaeefbea0e4e17bddfbd388f38\n runc:\n  Version:\t1.1.6\n  GitCommit:\tv1.1.6-0-g0f48801a\nroot@k8s-master-1:~#\n'})}),"\n",(0,a.jsx)("a",{name:"f76tT"}),"\n",(0,a.jsx)(n.h5,{id:"322nerdctl-\u914d\u7f6e\u6587\u4ef6",children:"3.2.2\u3001nerdctl \u914d\u7f6e\u6587\u4ef6"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'mkdir -p /etc/nerdctl\n\ncat > /etc/nerdctl/nerdctl.toml <<EOF\nnamespace = "k8s.io"\ndebug = false\ndebug_full = false\ninsecure_registry = true\nEOF\n'})}),"\n",(0,a.jsx)("a",{name:"yr6bX"}),"\n",(0,a.jsx)(n.h5,{id:"323nerdctl-\u4e0b\u8f7d-nginx-\u955c\u50cf",children:"3.2.3\u3001nerdctl \u4e0b\u8f7d nginx \u955c\u50cf"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"root@master1:/k8s-data# nerdctl pull nginx\ndocker.io/library/nginx:latest:                                                   resolved       |++++++++++++++++++++++++++++++++++++++|\nindex-sha256:c26ae7472d624ba1fafd296e73cecc4f93f853088e6a9c13c0d52f6ca5865107:    exists         |++++++++++++++++++++++++++++++++++++++|\nmanifest-sha256:05aa73005987caaed48ea8213696b0df761ccd600d2c53fc0a1a97a180301d71: exists         |++++++++++++++++++++++++++++++++++++++|\nconfig-sha256:e4720093a3c1381245b53a5a51b417963b3c4472d3f47fc301930a4f3b17666a:   exists         |++++++++++++++++++++++++++++++++++++++|\nlayer-sha256:c3ea3344e711fd7111dee02f17deebceb725ed1d0ee998f7fb472114dc1399ce:    exists         |++++++++++++++++++++++++++++++++++++++|\nlayer-sha256:18a869624cb60aaa916942dc71c22b194a078dcbbb9b8f54d40512eba55f70b8:    exists         |++++++++++++++++++++++++++++++++++++++|\nlayer-sha256:cc1bb4345a3a849289cfb3e2471c096f374423ec1ef74766137b9de546498612:    exists         |++++++++++++++++++++++++++++++++++++++|\nlayer-sha256:88f6f236f401ac07aa5309d8ade2b0c9d24b9f526bd4e73311bf5c1787cfd49c:    downloading    |++++++++++++++++++++++++++------------| 28.0 MiB/39.5 MiB\nlayer-sha256:da8fa4352481b358fc60d40ee20d92da64124d2cf405115640d45980339f47e5:    exists         |++++++++++++++++++++++++++++++++++++++|\nlayer-sha256:c7f80e9cdab20387cd09e3c47121ef0eb531043cf0aca1a52aab659de3ccb704:    exists         |++++++++++++++++++++++++++++++++++++++|\nelapsed: 7.1 s                                                                    total:  28.0 M (3.9 MiB/s) \n"})}),"\n",(0,a.jsx)("a",{name:"P2rJ0"}),"\n",(0,a.jsx)(n.h5,{id:"324nerdctl-\u521b\u5efa-nginx-\u5bb9\u5668",children:"3.2.4\u3001nerdctl \u521b\u5efa nginx \u5bb9\u5668"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"#nerdctl \u521b\u5efa nginx \u5bb9\u5668\nnerdctl run -d -p 80:80 --name=nginx-web1 --restart=always nginx\n686b2ab0ffa65e3d25a0ca4e51e0dc9f0ea31dab4548e4c380ddb089c5bee077\n\n\n#\u5220\u9664\u5bb9\u5668\nnerdctl rm 686b2ab0ffa6 -f\n686b2ab0ffa6\n\n\n#\u5220\u9664\u955c\u50cf\nroot@master1:/k8s-data# nerdctl rmi c26ae7472d62\nUntagged: docker.io/library/nginx:latest@sha256:c26ae7472d624ba1fafd296e73cecc4f93f853088e6a9c13c0d52f6ca5865107\nDeleted: sha256:ceb365432eec83dafc777cac5ee87737b093095035c89dd2eae01970c57b1d15\nDeleted: sha256:84619992a45bb790ab8f77ff523e52fc76dadfe17e205db6a111d0f657d31d71\nDeleted: sha256:3137f8f0c6412c12b46fd397866589505b4474e53580b4e62133da67bf1b2903\nDeleted: sha256:7d52a4114c3602761999a4ea2f84a093c8fcc8662876acc4c3b92878b9948547\nDeleted: sha256:188d128a188cafb013db48e94d9366f0be64083619f50b452cfd093e7affa260\nDeleted: sha256:bcc6856722b7b251ad00728c9cd93b679c7836d5e6780b52316b56c20fd5be94\nDeleted: sha256:61a7fb4dabcd05eba747fed22ff5264f82066d2bf8e16f78198f616e700f5aa7\n\nnerdctl images\nREPOSITORY    TAG       IMAGE ID        CREATED          PLATFORM       SIZE         BLOB SIZE\nnginx         latest    c26ae7472d62    2 minutes ago    linux/amd64    191.9 MiB    67.3 MiB\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'#\u9a8c\u8bc1 nginx \u670d\u52a1\ncurl 192.168.29.6\n-----------------\n<!DOCTYPE html>\n<html>\n<head>\n<title>Welcome to nginx!</title>\n<style>\nhtml { color-scheme: light dark; }\nbody { width: 35em; margin: 0 auto;\nfont-family: Tahoma, Verdana, Arial, sans-serif; }\n</style>\n</head>\n<body>\n<h1>Welcome to nginx!</h1>\n<p>If you see this page, the nginx web server is successfully installed and\nworking. Further configuration is required.</p>\n\n<p>For online documentation and support please refer to\n<a href="http://nginx.org/">nginx.org</a>.<br/>\nCommercial support is available at\n<a href="http://nginx.com/">nginx.com</a>.</p>\n\n<p><em>Thank you for using nginx.</em></p>\n</body>\n</html>\n'})}),"\n",(0,a.jsx)("a",{name:"stLGk"}),"\n",(0,a.jsx)(n.h5,{id:"325nerdctl-\u67e5\u770b-nginx-\u5bb9\u5668\u65e5\u5fd7",children:"3.2.5\u3001nerdctl \u67e5\u770b nginx \u5bb9\u5668\u65e5\u5fd7"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'nerdctl logs -f nginx-web1\n/docker-entrypoint.sh: /docker-entrypoint.d/ is not empty, will attempt to perform configuration\n/docker-entrypoint.sh: Looking for shell scripts in /docker-entrypoint.d/\n/docker-entrypoint.sh: Launching /docker-entrypoint.d/10-listen-on-ipv6-by-default.sh\n10-listen-on-ipv6-by-default.sh: info: Getting the checksum of /etc/nginx/conf.d/default.conf\n10-listen-on-ipv6-by-default.sh: info: Enabled listen on IPv6 in /etc/nginx/conf.d/default.conf\n/docker-entrypoint.sh: Sourcing /docker-entrypoint.d/15-local-resolvers.envsh\n/docker-entrypoint.sh: Launching /docker-entrypoint.d/20-envsubst-on-templates.sh\n/docker-entrypoint.sh: Launching /docker-entrypoint.d/30-tune-worker-processes.sh\n/docker-entrypoint.sh: Configuration complete; ready for start up\n2024/03/01 07:39:41 [notice] 1#1: using the "epoll" event method\n2024/03/01 07:39:41 [notice] 1#1: nginx/1.25.4\n2024/03/01 07:39:41 [notice] 1#1: built by gcc 12.2.0 (Debian 12.2.0-14)\n2024/03/01 07:39:41 [notice] 1#1: OS: Linux 5.15.0-100-generic\n2024/03/01 07:39:41 [notice] 1#1: getrlimit(RLIMIT_NOFILE): 1048576:1048576\n2024/03/01 07:39:41 [notice] 1#1: start worker processes\n2024/03/01 07:39:41 [notice] 1#1: start worker process 30\n2024/03/01 07:39:41 [notice] 1#1: start worker process 31\n192.168.29.6 - - [01/Mar/2024:07:40:02 +0000] "GET / HTTP/1.1" 200 615 "-" "curl/7.81.0" "-"\n192.168.29.12 - - [01/Mar/2024:07:40:32 +0000] "GET / HTTP/1.1" 200 615 "-" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36" "-"\n2024/03/01 07:40:33 [error] 30#30: *2 open() "/usr/share/nginx/html/favicon.ico" failed (2: No such file or directory), client: 192.168.29.12, server: localhost, request: "GET /favicon.ico HTTP/1.1", host: "192.168.29.6", referrer: "http://192.168.29.6/"\n192.168.29.12 - - [01/Mar/2024:07:40:33 +0000] "GET /favicon.ico HTTP/1.1" 404 555 "http://192.168.29.6/" "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/122.0.0.0 Safari/537.36" "-"\n\n'})}),"\n",(0,a.jsx)("a",{name:"gIPzD"}),"\n",(0,a.jsx)(n.h5,{id:"326nerdctl-\u67e5\u770b\u5bb9\u5668",children:"3.2.6\u3001nerdctl \u67e5\u770b\u5bb9\u5668"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'nerdctl ps -a\nCONTAINER ID    IMAGE                             COMMAND                   CREATED               STATUS    PORTS                 NAMES\n686b2ab0ffa6    docker.io/library/nginx:latest    "/docker-entrypoint.\u2026"    About a minute ago    Up        0.0.0.0:80->80/tcp    nginx-web1\n'})}),"\n",(0,a.jsx)("a",{name:"mYclI"}),"\n",(0,a.jsx)(n.h2,{id:"\u4e8c\u4f7f\u7528-kubeadm-\u90e8\u7f72-kubernetes",children:"\u4e8c\u3001\u4f7f\u7528 kubeadm \u90e8\u7f72 Kubernetes"}),"\n",(0,a.jsx)(n.p,{children:"\u4e0a\u9762\u7684\u76f8\u5173\u73af\u5883\u914d\u7f6e\u4e5f\u5b8c\u6210\u4e86\uff0c\u73b0\u5728\u6211\u4eec\u5c31\u53ef\u4ee5\u6765\u5b89\u88c5 Kubeadm \u4e86"}),"\n",(0,a.jsxs)(n.table,{children:[(0,a.jsx)(n.thead,{children:(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.th,{children:"\u8282\u70b9\u540d\u79f0"}),(0,a.jsx)(n.th,{children:"\u64cd\u4f5c\u7cfb\u7edf"}),(0,a.jsx)(n.th,{children:"IP\u5730\u5740"})]})}),(0,a.jsxs)(n.tbody,{children:[(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"master1"}),(0,a.jsx)(n.td,{children:"Ubuntu 22.04 LTS"}),(0,a.jsx)(n.td,{children:"192.168.29.6"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"node1"}),(0,a.jsx)(n.td,{children:"Ubuntu 22.04 LTS"}),(0,a.jsx)(n.td,{children:"192.168.29.7"})]}),(0,a.jsxs)(n.tr,{children:[(0,a.jsx)(n.td,{children:"node2"}),(0,a.jsx)(n.td,{children:"Ubuntu 22.04 LTS"}),(0,a.jsx)(n.td,{children:"192.168.29.8"})]})]})]}),"\n",(0,a.jsx)("a",{name:"CFb1B"}),"\n",(0,a.jsx)(n.h3,{id:"21-\u5b89\u88c5kubeadmkubectlkubelet",children:"2.1 \u5b89\u88c5kubeadm\u3001kubectl\u3001kubelet"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"k8s-master \u670d\u52a1\u5668\uff1a"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"apt-get update && apt-get install -y apt-transport-https \n\ncurl https://mirrors.aliyun.com/kubernetes/apt/doc/apt-key.gpg | apt-key add -;\n\ncat <<EOF >/etc/apt/sources.list.d/kubernetes.list\ndeb https://mirrors.aliyun.com/kubernetes/apt/ kubernetes-xenial main\nEOF\n\napt-get update && apt-cache madison kubeadm \napt-get install -y kubeadm=1.22.2-00 kubectl=1.22.2-00 kubelet=1.22.2-00\n\n"})}),"\n",(0,a.jsxs)(n.p,{children:[(0,a.jsx)("br",{}),'** kubernetes-xenial/**" \u8868\u793a\u4e00\u4e2a\u540d\u4e3a "xenial" \u7684\u4ed3\u5e93\uff0c\u8be5\u4ed3\u5e93\u5305\u542b\u4e86\u9002\u7528\u4e8e Ubuntu 16.04 (Xenial Xerus) \u7684 Kubernetes \u8f6f\u4ef6\u5305\u3002\u7c7b\u4f3c\u5730\uff0c"kubernetes-trusty/" \u5219\u53ef\u80fd\u5305\u542b\u4e86\u9002\u7528\u4e8e Ubuntu 14.04 (Trusty Tahr) \u7684 Kubernetes \u8f6f\u4ef6\u5305\u3002']}),"\n",(0,a.jsx)("a",{name:"MBL7A"}),"\n",(0,a.jsx)(n.h3,{id:"22-\u521d\u59cb\u5316\u96c6\u7fa4",children:"2.2 \u521d\u59cb\u5316\u96c6\u7fa4"}),"\n",(0,a.jsxs)(n.p,{children:["\u5f53\u6211\u4eec\u6267\u884c",(0,a.jsx)(n.code,{children:" kubelet --help"})," \u547d\u4ee4\u7684\u65f6\u5019\u53ef\u4ee5\u770b\u5230\u539f\u6765\u5927\u90e8\u5206\u547d\u4ee4\u884c\u53c2\u6570\u90fd\u88ab DEPRECATED\u4e86\uff0c\u8fd9\u662f\u56e0\u4e3a\u5b98\u65b9\u63a8\u8350\u6211\u4eec\u4f7f\u7528 --config \u6765\u6307\u5b9a\u914d\u7f6e\u6587\u4ef6\uff0c\u5728\u914d\u7f6e\u6587\u4ef6\u4e2d\u6307\u5b9a\u539f\u6765\u8fd9\u4e9b\u53c2\u6570\u7684\u914d\u7f6e\uff0c\u53ef\u4ee5\u901a\u8fc7\u5b98\u65b9\u6587\u6863 ",(0,a.jsx)(n.a,{href:"https://kubernetes.io/docs/tasks/administer-cluster/kubelet-config-file/",children:"Set Kubelet parameters via a config file"})," \u4e86\u89e3\u66f4\u591a\u76f8\u5173\u4fe1\u606f\uff0c\u8fd9\u6837 Kubernetes \u5c31\u53ef\u4ee5\u652f\u6301\u52a8\u6001 Kubelet \u914d\u7f6e\uff08Dynamic Kubelet Configuration\uff09\u4e86\uff0c\u53c2\u8003 ",(0,a.jsx)(n.a,{href:"https://kubernetes.io/docs/tasks/administer-cluster/reconfigure-kubelet/",children:"Reconfigure a Node\u2019s Kubelet in a Live Cluster"}),"\u3002",(0,a.jsx)("br",{}),"\u7136\u540e\u6211\u4eec\u53ef\u4ee5\u901a\u8fc7\u4e0b\u9762\u7684\u547d\u4ee4\u5728 master \u8282\u70b9\u4e0a\u8f93\u51fa\u96c6\u7fa4\u521d\u59cb\u5316\u9ed8\u8ba4\u4f7f\u7528\u7684\u914d\u7f6e\uff1a"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubeadm config print init-defaults --component-configs KubeletConfiguration > kubeadm.yaml\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\u7136\u540e\u6839\u636e\u6211\u4eec\u81ea\u5df1\u7684\u9700\u6c42\u4fee\u6539\u914d\u7f6e\uff0c\u6bd4\u5982\u4fee\u6539 imageRepository \u6307\u5b9a\u96c6\u7fa4\u521d\u59cb\u5316\u65f6\u62c9\u53d6 Kubernetes \u6240\u9700\u955c\u50cf\u7684\u5730\u5740\uff0ckube-proxy \u7684\u6a21\u5f0f\u4e3a ipvs\uff0c\u53e6\u5916\u9700\u8981\u6ce8\u610f\u7684\u662f\u6211\u4eec\u8fd9\u91cc\u662f\u51c6\u5907\u5b89\u88c5 flannel \u7f51\u7edc\u63d2\u4ef6\u7684\uff0c\u9700\u8981\u5c06 ",(0,a.jsx)(n.code,{children:"networking.podSubnet"})," \u8bbe\u7f6e\u4e3a ",(0,a.jsx)(n.code,{children:"10.244.0.0/16:"})]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'# kubeadm.yaml\napiVersion: kubeadm.k8s.io/v1beta3\nbootstrapTokens:\n  - groups:\n      - system:bootstrappers:kubeadm:default-node-token\n    token: abcdef.0123456789abcdef\n    ttl: 24h0m0s\n    usages:\n      - signing\n      - authentication\nkind: InitConfiguration\nlocalAPIEndpoint:\n  advertiseAddress: 192.168.29.6 # \u6307\u5b9amaster\u8282\u70b9\u5185\u7f51IP\n  bindPort: 6443\nnodeRegistration:\n  criSocket: /run/containerd/containerd.sock # \u4f7f\u7528 containerd\u7684Unix socket \u5730\u5740\n  imagePullPolicy: IfNotPresent\n  name: master1\n  taints: # \u7ed9master\u6dfb\u52a0\u6c61\u70b9\uff0cmaster\u8282\u70b9\u4e0d\u80fd\u8c03\u5ea6\u5e94\u7528\n    - effect: "NoSchedule"\n      key: "node-role.kubernetes.io/master"\n\n---\napiVersion: kubeproxy.config.k8s.io/v1alpha1\nkind: KubeProxyConfiguration\nmode: ipvs # kube-proxy \u6a21\u5f0f\n\n---\napiServer:\n  timeoutForControlPlane: 4m0s\napiVersion: kubeadm.k8s.io/v1beta3\ncertificatesDir: /etc/kubernetes/pki\nclusterName: kubernetes\ncontrollerManager: {}\ndns: {}\netcd:\n  local:\n    dataDir: /var/lib/etcd\nimageRepository: registry.cn-hangzhou.aliyuncs.com/google_containers #\u6307\u5b9a\u955c\u50cf\u4ed3\u5e93\nkind: ClusterConfiguration\nkubernetesVersion: v1.22.2 #\u6307\u5b9aK8S\u7248\u672c\nnetworking:\n  dnsDomain: cluster.local\n  serviceSubnet: 10.96.0.0/12\n  podSubnet: 10.244.0.0/16 # \u6307\u5b9a pod \u5b50\u7f51\nscheduler: {}\n\n---\napiVersion: kubelet.config.k8s.io/v1beta1\nauthentication:\n  anonymous:\n    enabled: false\n  webhook:\n    cacheTTL: 0s\n    enabled: true\n  x509:\n    clientCAFile: /etc/kubernetes/pki/ca.crt\nauthorization:\n  mode: Webhook\n  webhook:\n    cacheAuthorizedTTL: 0s\n    cacheUnauthorizedTTL: 0s\nclusterDNS:\n  - 10.96.0.10\nclusterDomain: cluster.local\ncpuManagerReconcilePeriod: 0s\nevictionPressureTransitionPeriod: 0s\nfileCheckFrequency: 0s\nhealthzBindAddress: 127.0.0.1\nhealthzPort: 10248\nhttpCheckFrequency: 0s\nimageMinimumGCAge: 0s\nkind: KubeletConfiguration\nlogging: {}\nmemorySwap: {}\nnodeStatusReportFrequency: 0s\nnodeStatusUpdateFrequency: 0s\nrotateCertificates: true\nruntimeRequestTimeout: 0s\nshutdownGracePeriod: 0s\nshutdownGracePeriodCriticalPods: 0s\nstaticPodPath: /etc/kubernetes/manifests\nstreamingConnectionIdleTimeout: 0s\nsyncFrequency: 0s\nvolumeStatsAggPeriod: 0s\n'})}),"\n",(0,a.jsxs)(n.p,{children:["\u5bf9\u4e8e\u4e0a\u9762\u7684\u8d44\u6e90\u6e05\u5355\u7684\u6587\u6863\u6bd4\u8f83\u6742\uff0c\u8981\u60f3\u5b8c\u6574\u4e86\u89e3\u4e0a\u9762\u7684\u8d44\u6e90\u5bf9\u8c61\u5bf9\u5e94\u7684\u5c5e\u6027\uff0c\u53ef\u4ee5\u67e5\u770b\u5bf9\u5e94\u7684 godoc \u6587\u6863\uff0c\u5730\u5740:",(0,a.jsx)(n.a,{href:"https://godoc.org/k8s.io/kubernetes/cmd/kubeadm/app/apis/kubeadm/v1beta3",children:"https://godoc.org/k8s.io/kubernetes/cmd/kubeadm/app/apis/kubeadm/v1beta3"}),"\u3002"]}),"\n",(0,a.jsxs)(n.p,{children:["\u5728\u5f00\u59cb\u521d\u59cb\u5316\u96c6\u7fa4\u4e4b\u524d\u53ef\u4ee5\u4f7f\u7528 ",(0,a.jsx)(n.code,{children:"kubeadm config images pull --config kubeadm.yaml"})," \u9884\u5148\u5728\u5404\u4e2a\u670d\u52a1\u5668\u8282\u70b9\u4e0a\u62c9\u53d6\u6240 k8s \u9700\u8981\u7684\u5bb9\u5668\u955c\u50cf\u3002",(0,a.jsx)("br",{}),"\u914d\u7f6e\u6587\u4ef6\u51c6\u5907\u597d\u8fc7\u540e\uff0c\u53ef\u4ee5\u4f7f\u7528\u5982\u4e0b\u547d\u4ee4\u5148\u5c06\u76f8\u5173\u955c\u50cf pull \u4e0b\u9762\uff1a"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:'kubeadm config images pull --image-repository="registry.cn-hangzhou.aliyuncs.com/google_containers" --kubernetes-version=v1.22.2\n\n[config/images] Pulled registry.cn-hangzhou.aliyuncs.com/google_containers/kube-apiserver:v1.22.2\n[config/images] Pulled registry.cn-hangzhou.aliyuncs.com/google_containers/kube-controller-manager:v1.22.2\n[config/images] Pulled registry.cn-hangzhou.aliyuncs.com/google_containers/kube-scheduler:v1.22.2\n[config/images] Pulled registry.cn-hangzhou.aliyuncs.com/google_containers/kube-proxy:v1.22.2\n[config/images] Pulled registry.cn-hangzhou.aliyuncs.com/google_containers/pause:3.5\n[config/images] Pulled registry.cn-hangzhou.aliyuncs.com/google_containers/etcd:3.5.0-0\n[config/images] Pulled registry.cn-hangzhou.aliyuncs.com/google_containers/coredns:v1.8.4\n\n#\u6216\u8005\nkubeadm config images pull --config kubeadm.yaml\n'})}),"\n",(0,a.jsx)(n.p,{children:"\u7136\u540e\u5c31\u53ef\u4ee5\u4f7f\u7528\u4e0a\u9762\u7684\u914d\u7f6e\u6587\u4ef6\u5728 master \u8282\u70b9\u4e0a\u8fdb\u884c\u521d\u59cb\u5316\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'kubeadm init --config kubeadm.yaml\n\nroot@master1:/k8s-data# kubeadm init --config kubeadm.yaml\n[init] Using Kubernetes version: v1.22.2\n[preflight] Running pre-flight checks\n[preflight] Pulling images required for setting up a Kubernetes cluster\n[preflight] This might take a minute or two, depending on the speed of your internet connection\n[preflight] You can also perform this action in beforehand using \'kubeadm config images pull\'\n[certs] Using certificateDir folder "/etc/kubernetes/pki"\n[certs] Generating "ca" certificate and key\n[certs] Generating "apiserver" certificate and key\n[certs] apiserver serving cert is signed for DNS names [kubernetes kubernetes.default kubernetes.default.svc kubernetes.default.                                 svc.cluster.local master1] and IPs [10.96.0.1 192.168.29.6]\n[certs] Generating "apiserver-kubelet-client" certificate and key\n[certs] Generating "front-proxy-ca" certificate and key\n[certs] Generating "front-proxy-client" certificate and key\n[certs] Generating "etcd/ca" certificate and key\n[certs] Generating "etcd/server" certificate and key\n[certs] etcd/server serving cert is signed for DNS names [localhost master1] and IPs [192.168.29.6 127.0.0.1 ::1]\n[certs] Generating "etcd/peer" certificate and key\n[certs] etcd/peer serving cert is signed for DNS names [localhost master1] and IPs [192.168.29.6 127.0.0.1 ::1]\n[certs] Generating "etcd/healthcheck-client" certificate and key\n[certs] Generating "apiserver-etcd-client" certificate and key\n[certs] Generating "sa" key and public key\n[kubeconfig] Using kubeconfig folder "/etc/kubernetes"\n[kubeconfig] Writing "admin.conf" kubeconfig file\n[kubeconfig] Writing "kubelet.conf" kubeconfig file\n[kubeconfig] Writing "controller-manager.conf" kubeconfig file\n[kubeconfig] Writing "scheduler.conf" kubeconfig file\n[kubelet-start] Writing kubelet environment file with flags to file "/var/lib/kubelet/kubeadm-flags.env"\n[kubelet-start] Writing kubelet configuration to file "/var/lib/kubelet/config.yaml"\n[kubelet-start] Starting the kubelet\n[control-plane] Using manifest folder "/etc/kubernetes/manifests"\n[control-plane] Creating static Pod manifest for "kube-apiserver"\n[control-plane] Creating static Pod manifest for "kube-controller-manager"\n[control-plane] Creating static Pod manifest for "kube-scheduler"\n[etcd] Creating static Pod manifest for local etcd in "/etc/kubernetes/manifests"\n[wait-control-plane] Waiting for the kubelet to boot up the control plane as static Pods from directory "/etc/kubernetes/manifests". This can take up to 4m0s\n[apiclient] All control plane components are healthy after 15.004519 seconds\n[upload-config] Storing the configuration used in ConfigMap "kubeadm-config" in the "kube-system" Namespace\n[kubelet] Creating a ConfigMap "kubelet-config-1.22" in namespace kube-system with the configuration for the kubelets in the cluster\n[upload-certs] Skipping phase. Please see --upload-certs\n[mark-control-plane] Marking the node master1 as control-plane by adding the labels: [node-role.kubernetes.io/master(deprecated) node-role.kubernetes.io/control-plane node.kubernetes.io/exclude-from-external-load-balancers]\n[mark-control-plane] Marking the node master1 as control-plane by adding the taints [node-role.kubernetes.io/master:NoSchedule]\n[bootstrap-token] Using token: abcdef.0123456789abcdef\n[bootstrap-token] Configuring bootstrap tokens, cluster-info ConfigMap, RBAC Roles\n[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to get nodes\n[bootstrap-token] configured RBAC rules to allow Node Bootstrap tokens to post CSRs in order for nodes to get long term certificate credentials\n[bootstrap-token] configured RBAC rules to allow the csrapprover controller automatically approve CSRs from a Node Bootstrap Token\n[bootstrap-token] configured RBAC rules to allow certificate rotation for all node client certificates in the cluster\n[bootstrap-token] Creating the "cluster-info" ConfigMap in the "kube-public" namespace\n[kubelet-finalize] Updating "/etc/kubernetes/kubelet.conf" to point to a rotatable kubelet client certificate and key\n[addons] Applied essential addon: CoreDNS\n[addons] Applied essential addon: kube-proxy\n\nYour Kubernetes control-plane has initialized successfully!\n\nTo start using your cluster, you need to run the following as a regular user:\n\n  mkdir -p $HOME/.kube\n  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n  sudo chown $(id -u):$(id -g) $HOME/.kube/config\n\nAlternatively, if you are the root user, you can run:\n\n  export KUBECONFIG=/etc/kubernetes/admin.conf\n\nYou should now deploy a pod network to the cluster.\nRun "kubectl apply -f [podnetwork].yaml" with one of the options listed at:\n  https://kubernetes.io/docs/concepts/cluster-administration/addons/\n\nThen you can join any number of worker nodes by running the following on each as root:\n\nkubeadm join 192.168.29.6:6443 --token abcdef.0123456789abcdef \\\n        --discovery-token-ca-cert-hash sha256:4f2d432f75baf1737c8b0127681f62b6fc32d014f01f5175fabc4a62c766d547\n\n'})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"\u751f\u6210\u65b0\u7684token"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"## \u9ed8\u8ba4\u6709\u6548\u671f24\u5c0f\u65f6,\u82e5\u60f3\u4e45\u4e00\u4e9b\u53ef\u4ee5\u7ed3\u5408\u2013ttl\u53c2\u6570,\u8bbe\u4e3a0\u5219\u7528\u4e0d\u8fc7\u671f\nroot@master1:~#  kubeadm token create --print-join-command\nkubeadm join 192.168.29.6:6443 --token m2catr.8abhdpznbtbsoywa --discovery-token-ca-cert-hash sha256:4f2d432f75baf1737c8b0127681f62b6fc32d014f01f5175fabc4a62c766d547\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u6839\u636e\u5b89\u88c5\u63d0\u793a\u62f7\u8d1d kubeconfig \u6587\u4ef6\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"mkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u7136\u540e\u53ef\u4ee5\u4f7f\u7528 kubectl \u547d\u4ee4\u67e5\u770b master \u8282\u70b9\u5df2\u7ecf\u521d\u59cb\u5316\u6210\u529f\u4e86\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"root@master1:~# kubectl get nodes\nNAME      STATUS   ROLES                  AGE     VERSION\nmaster1   Ready    control-plane,master   2d23h   v1.22.2\nnode1     Ready    <none>                 62s     v1.22.2\nnode2     Ready    <none>                 58s     v1.22.2\n"})}),"\n",(0,a.jsx)("a",{name:"l6Vd3"}),"\n",(0,a.jsx)(n.h2,{id:"\u4e09\u6dfb\u52a0\u8282\u70b9",children:"\u4e09\u3001\u6dfb\u52a0\u8282\u70b9"}),"\n",(0,a.jsx)("a",{name:"aLiKy"}),"\n",(0,a.jsx)(n.h3,{id:"31\u6dfb\u52a0-node-\u8282\u70b9",children:"3.1\u6dfb\u52a0 node \u8282\u70b9"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"node1 \u670d\u52a1\u5668\u52a0\u5165\u8282\u70b9"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"root@node1:~# kubeadm join 192.168.29.6:6443 --token m2catr.8abhdpznbtbsoywa --discovery-token-ca-cert-hash sha256:4f2d432f75baf1737c8b0127681f62b6fc32d014f01f5175fabc4a62c766d547\n[preflight] Running pre-flight checks\n[preflight] Reading configuration from the cluster...\n[preflight] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -o yaml'\n[kubelet-start] Writing kubelet configuration to file \"/var/lib/kubelet/config.yaml\"\n[kubelet-start] Writing kubelet environment file with flags to file \"/var/lib/kubelet/kubeadm-flags.env\"\n[kubelet-start] Starting the kubelet\n[kubelet-start] Waiting for the kubelet to perform the TLS Bootstrap...\n\nThis node has joined the cluster:\n* Certificate signing request was sent to apiserver and a response was received.\n* The Kubelet was informed of the new secure connection details.\n\nRun 'kubectl get nodes' on the control-plane to see this node join the cluster.\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"node2 \u670d\u52a1\u5668\u52a0\u5165\u8282\u70b9"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"root@node2:~# kubeadm join 192.168.29.6:6443 --token m2catr.8abhdpznbtbsoywa --discovery-token-ca-cert-hash sha256:4f2d432f75baf1737c8b0127681f62b6fc32d014f01f5175fabc4a62c766d547\n[preflight] Running pre-flight checks\n[preflight] Reading configuration from the cluster...\n[preflight] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -o yaml'\n[kubelet-start] Writing kubelet configuration to file \"/var/lib/kubelet/config.yaml\"\n[kubelet-start] Writing kubelet environment file with flags to file \"/var/lib/kubelet/kubeadm-flags.env\"\n[kubelet-start] Starting the kubelet\n[kubelet-start] Waiting for the kubelet to perform the TLS Bootstrap...\n\nThis node has joined the cluster:\n* Certificate signing request was sent to apiserver and a response was received.\n* The Kubelet was informed of the new secure connection details.\n\nRun 'kubectl get nodes' on the control-plane to see this node join the cluster.\n"})}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"\u67e5\u770b node \u8282\u70b9"})}),"\n",(0,a.jsx)("a",{name:"LS2n7"}),"\n",(0,a.jsx)(n.h3,{id:"32-\u6dfb\u52a0-master-\u8282\u70b9",children:"3.2 \u6dfb\u52a0 master \u8282\u70b9"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.strong,{children:"\u5f53\u524dmaste\u2f63\u6210\u8bc1\u4e66\u2f64\u4e8e\u6dfb\u52a0\u65b0\u63a7\u5236\u8282\u70b9"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubeadm init phase upload-certs --upload-certs\n"})}),"\n",(0,a.jsx)("a",{name:"CboDG"}),"\n",(0,a.jsx)(n.h2,{id:"\u56db\u90e8\u7f72\u7f51\u7edc\u7ec4\u4ef6",children:"\u56db\u3001\u90e8\u7f72\u7f51\u7edc\u7ec4\u4ef6"}),"\n",(0,a.jsxs)(n.p,{children:["\u8fd9\u4e2a\u65f6\u5019\u5176\u5b9e\u96c6\u7fa4\u8fd8\u4e0d\u80fd\u6b63\u5e38\u4f7f\u7528\uff0c\u56e0\u4e3a\u8fd8\u6ca1\u6709\u5b89\u88c5\u7f51\u7edc\u63d2\u4ef6\uff0c\u63a5\u4e0b\u6765\u5b89\u88c5\u7f51\u7edc\u63d2\u4ef6\uff0c\u53ef\u4ee5\u5728\u6587\u6863 ",(0,a.jsx)(n.a,{href:"https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/",children:"https://kubernetes.io/docs/setup/production-environment/tools/kubeadm/create-cluster-kubeadm/"})," \u4e2d\u9009\u62e9\u6211\u4eec\u81ea\u5df1\u7684\u7f51\u7edc\u63d2\u4ef6\uff0c\u8fd9\u91cc\u6211\u4eec\u5b89\u88c5 flannel:"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"wget https://raw.githubusercontent.com/coreos/flannel/master/Documentation/kube-flannel.yml\n# \u5982\u679c\u6709\u8282\u70b9\u662f\u591a\u7f51\u5361\uff0c\u5219\u9700\u8981\u5728\u8d44\u6e90\u6e05\u5355\u6587\u4ef6\u4e2d\u6307\u5b9a\u5185\u7f51\u7f51\u5361\n# \u641c\u7d22\u5230\u540d\u4e3a kube-flannel-ds \u7684 DaemonSet\uff0c\u5728kube-flannel\u5bb9\u5668\u4e0b\u9762\n\n\nvi kube-flannel.yml\n......\ncontainers:\n- name: kube-flannel\n  image: quay.io/coreos/flannel:v0.15.0\n  command:\n  - /opt/bin/flanneld\n  args:\n  - --ip-masq\n  - --kube-subnet-mgr\n  - --iface=eth0  # \u5982\u679c\u662f\u591a\u7f51\u5361\u7684\u8bdd\uff0c\u6307\u5b9a\u5185\u7f51\u7f51\u5361\u7684\u540d\u79f0\n......\n\nkubectl apply -f kube-flannel.yml  # \u5b89\u88c5 flannel \u7f51\u7edc\u63d2\u4ef6\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'---\nkind: Namespace\napiVersion: v1\nmetadata:\n  name: kube-flannel\n  labels:\n    k8s-app: flannel\n    pod-security.kubernetes.io/enforce: privileged\n---\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  labels:\n    k8s-app: flannel\n  name: flannel\nrules:\n- apiGroups:\n  - ""\n  resources:\n  - pods\n  verbs:\n  - get\n- apiGroups:\n  - ""\n  resources:\n  - nodes\n  verbs:\n  - get\n  - list\n  - watch\n- apiGroups:\n  - ""\n  resources:\n  - nodes/status\n  verbs:\n  - patch\n- apiGroups:\n  - networking.k8s.io\n  resources:\n  - clustercidrs\n  verbs:\n  - list\n  - watch\n---\nkind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  labels:\n    k8s-app: flannel\n  name: flannel\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: flannel\nsubjects:\n- kind: ServiceAccount\n  name: flannel\n  namespace: kube-flannel\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  labels:\n    k8s-app: flannel\n  name: flannel\n  namespace: kube-flannel\n---\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  name: kube-flannel-cfg\n  namespace: kube-flannel\n  labels:\n    tier: node\n    k8s-app: flannel\n    app: flannel\ndata:\n  cni-conf.json: |\n    {\n      "name": "cbr0",\n      "cniVersion": "0.3.1",\n      "plugins": [\n        {\n          "type": "flannel",\n          "delegate": {\n            "hairpinMode": true,\n            "isDefaultGateway": true\n          }\n        },\n        {\n          "type": "portmap",\n          "capabilities": {\n            "portMappings": true\n          }\n        }\n      ]\n    }\n  net-conf.json: |\n    {\n      "Network": "10.244.0.0/16",\n      "Backend": {\n        "Type": "vxlan"\n      }\n    }\n---\napiVersion: apps/v1\nkind: DaemonSet\nmetadata:\n  name: kube-flannel-ds\n  namespace: kube-flannel\n  labels:\n    tier: node\n    app: flannel\n    k8s-app: flannel\nspec:\n  selector:\n    matchLabels:\n      app: flannel\n  template:\n    metadata:\n      labels:\n        tier: node\n        app: flannel\n    spec:\n      affinity:\n        nodeAffinity:\n          requiredDuringSchedulingIgnoredDuringExecution:\n            nodeSelectorTerms:\n            - matchExpressions:\n              - key: kubernetes.io/os\n                operator: In\n                values:\n                - linux\n      hostNetwork: true\n      priorityClassName: system-node-critical\n      tolerations:\n      - operator: Exists\n        effect: NoSchedule\n      serviceAccountName: flannel\n      initContainers:\n      - name: install-cni-plugin\n        image: registry.cn-hangzhou.aliyuncs.com/xxk8s/flannel-cni-plugin:v1.4.0-flannel1\n        command:\n        - cp\n        args:\n        - -f\n        - /flannel\n        - /opt/cni/bin/flannel\n        volumeMounts:\n        - name: cni-plugin\n          mountPath: /opt/cni/bin\n      - name: install-cni\n        image: registry.cn-hangzhou.aliyuncs.com/xxk8s/flannel:v0.24.2\n        command:\n        - cp\n        args:\n        - -f\n        - /etc/kube-flannel/cni-conf.json\n        - /etc/cni/net.d/10-flannel.conflist\n        volumeMounts:\n        - name: cni\n          mountPath: /etc/cni/net.d\n        - name: flannel-cfg\n          mountPath: /etc/kube-flannel/\n      containers:\n      - name: kube-flannel\n        image: registry.cn-hangzhou.aliyuncs.com/xxk8s/flannel:v0.24.2\n        command:\n        - /opt/bin/flanneld\n        args:\n        - --ip-masq\n        - --kube-subnet-mgr\n        - --iface=eth0\n        #- --iface=ens33\n        resources:\n          requests:\n            cpu: "100m"\n            memory: "50Mi"\n        securityContext:\n          privileged: false\n          capabilities:\n            add: ["NET_ADMIN", "NET_RAW"]\n        env:\n        - name: POD_NAME\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.name\n        - name: POD_NAMESPACE\n          valueFrom:\n            fieldRef:\n              fieldPath: metadata.namespace\n        - name: EVENT_QUEUE_DEPTH\n          value: "5000"\n        volumeMounts:\n        - name: run\n          mountPath: /run/flannel\n        - name: flannel-cfg\n          mountPath: /etc/kube-flannel/\n        - name: xtables-lock\n          mountPath: /run/xtables.lock\n      volumes:\n      - name: run\n        hostPath:\n          path: /run/flannel\n      - name: cni-plugin\n        hostPath:\n          path: /opt/cni/bin\n      - name: cni\n        hostPath:\n          path: /etc/cni/net.d\n      - name: flannel-cfg\n        configMap:\n          name: kube-flannel-cfg\n      - name: xtables-lock\n        hostPath:\n          path: /run/xtables.lock\n          type: FileOrCreate\n'})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"root@master1:~# kubectl apply -f /flannel.yml\nnamespace/kube-flannel created\nclusterrole.rbac.authorization.k8s.io/flannel created\nclusterrolebinding.rbac.authorization.k8s.io/flannel created\nserviceaccount/flannel created\nconfigmap/kube-flannel-cfg created\ndaemonset.apps/kube-flannel-ds created\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:'echo "source <(kubectl completion bash)" >> /etc/profile.d/k8s.sh\n\nsource /etc/profile.d/k8s.sh\n'})}),"\n",(0,a.jsx)(n.p,{children:"\u9694\u4e00\u4f1a\u513f\u67e5\u770b Pod \u8fd0\u884c\u72b6\u6001\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"root@master1:~# kubectl get pod -n kube-flannel\nNAME                    READY   STATUS    RESTARTS   AGE\nkube-flannel-ds-4jq85   1/1     Running   0          7m27s\nkube-flannel-ds-bskm9   1/1     Running   0          7m27s\nkube-flannel-ds-pg5d5   1/1     Running   0          7m27s\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\u5f53\u6211\u4eec\u90e8\u7f72\u5b8c\u7f51\u7edc\u63d2\u4ef6\u540e\u6267\u884c ifconfig \u547d\u4ee4\uff0c\u6b63\u5e38\u4f1a\u770b\u5230\u65b0\u589e\u7684",(0,a.jsx)(n.strong,{children:"cni0"}),"\u4e0e ",(0,a.jsx)(n.strong,{children:"flannel1"}),"\u8fd9\u4e24\u4e2a\u865a\u62df\u8bbe\u5907\uff0c\u4f46\u662f\u5982\u679c\u6ca1\u6709\u770b\u5230 cni0\u8fd9\u4e2a\u8bbe\u5907\u4e5f\u4e0d\u7528\u592a\u62c5\u5fc3\uff0c\u6211\u4eec\u53ef\u4ee5\u89c2\u5bdf ",(0,a.jsx)(n.code,{children:"/var/lib/cni"}),"\u76ee\u5f55\u662f\u5426\u5b58\u5728\uff0c\u5982\u679c\u4e0d\u5b58\u5728\u5e76\u4e0d\u662f\u8bf4\u90e8\u7f72\u6709\u95ee\u9898\uff0c\u800c\u662f\u8be5\u8282\u70b9\u4e0a\u6682\u65f6\u8fd8\u6ca1\u6709\u5e94\u7528\u8fd0\u884c\uff0c\u6211\u4eec\u53ea\u9700\u8981\u5728\u8be5\u8282\u70b9\u4e0a\u8fd0\u884c\u4e00\u4e2a Pod \u5c31\u53ef\u4ee5\u770b\u5230\u8be5\u76ee\u5f55\u4f1a\u88ab\u521b\u5efa\uff0c\u5e76\u4e14 cni0\u8bbe\u5907\u4e5f\u4f1a\u88ab\u521b\u5efa\u51fa\u6765\u3002"]}),"\n",(0,a.jsx)("a",{name:"P2b3v"}),"\n",(0,a.jsx)(n.h2,{id:"\u4e94dashboard",children:"\u4e94\u3001Dashboard"}),"\n",(0,a.jsx)(n.p,{children:"v1.22.2 \u7248\u672c\u7684\u96c6\u7fa4\u9700\u8981\u5b89\u88c5\u6700\u65b0\u7684 2.0+ \u7248\u672c\u7684 Dashboard\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"# \u63a8\u8350\u4f7f\u7528\u4e0b\u9762\u8fd9\u79cd\u65b9\u5f0f\nwget https://raw.githubusercontent.com/kubernetes/dashboard/v2.3.1/aio/deploy/recommended.yaml\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"vi recommended.yaml\n# \u4fee\u6539Service\u4e3aNodePort\u7c7b\u578b\n......\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kubernetes-dashboard\nspec:\n  ports:\n    - port: 443\n      targetPort: 8443\n  selector:\n    k8s-app: kubernetes-dashboard\n  type: NodePort  # \u52a0\u4e0atype=NodePort\u53d8\u6210NodePort\u7c7b\u578b\u7684\u670d\u52a1\n......\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'# Copyright 2017 The Kubernetes Authors.\n#\n# Licensed under the Apache License, Version 2.0 (the "License");\n# you may not use this file except in compliance with the License.\n# You may obtain a copy of the License at\n#\n#     http://www.apache.org/licenses/LICENSE-2.0\n#\n# Unless required by applicable law or agreed to in writing, software\n# distributed under the License is distributed on an "AS IS" BASIS,\n# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n# See the License for the specific language governing permissions and\n# limitations under the License.\n\napiVersion: v1\nkind: Namespace\nmetadata:\n  name: kubernetes-dashboard\n\n---\n\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kubernetes-dashboard\n\n---\n\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kubernetes-dashboard\nspec:\n  ports:\n    - port: 443\n      targetPort: 8443\n      nodePort: 30036\n  selector:\n    k8s-app: kubernetes-dashboard\n  type: NodePort\n\n---\n\napiVersion: v1\nkind: Secret\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard-certs\n  namespace: kubernetes-dashboard\ntype: Opaque\n\n---\n\napiVersion: v1\nkind: Secret\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard-csrf\n  namespace: kubernetes-dashboard\ntype: Opaque\ndata:\n  csrf: ""\n\n---\n\napiVersion: v1\nkind: Secret\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard-key-holder\n  namespace: kubernetes-dashboard\ntype: Opaque\n\n---\n\nkind: ConfigMap\napiVersion: v1\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard-settings\n  namespace: kubernetes-dashboard\n\n---\n\nkind: Role\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kubernetes-dashboard\nrules:\n  # Allow Dashboard to get, update and delete Dashboard exclusive secrets.\n  - apiGroups: [""]\n    resources: ["secrets"]\n    resourceNames: ["kubernetes-dashboard-key-holder", "kubernetes-dashboard-certs", "kubernetes-dashboard-csrf"]\n    verbs: ["get", "update", "delete"]\n    # Allow Dashboard to get and update \'kubernetes-dashboard-settings\' config map.\n  - apiGroups: [""]\n    resources: ["configmaps"]\n    resourceNames: ["kubernetes-dashboard-settings"]\n    verbs: ["get", "update"]\n    # Allow Dashboard to get metrics.\n  - apiGroups: [""]\n    resources: ["services"]\n    resourceNames: ["heapster", "dashboard-metrics-scraper"]\n    verbs: ["proxy"]\n  - apiGroups: [""]\n    resources: ["services/proxy"]\n    resourceNames: ["heapster", "http:heapster:", "https:heapster:", "dashboard-metrics-scraper", "http:dashboard-metrics-scraper"]\n    verbs: ["get"]\n\n---\n\nkind: ClusterRole\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\nrules:\n  # Allow Metrics Scraper to get metrics from the Metrics server\n  - apiGroups: ["metrics.k8s.io"]\n    resources: ["pods", "nodes"]\n    verbs: ["get", "list", "watch"]\n\n---\n\napiVersion: rbac.authorization.k8s.io/v1\nkind: RoleBinding\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kubernetes-dashboard\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: Role\n  name: kubernetes-dashboard\nsubjects:\n  - kind: ServiceAccount\n    name: kubernetes-dashboard\n    namespace: kubernetes-dashboard\n\n---\n\napiVersion: rbac.authorization.k8s.io/v1\nkind: ClusterRoleBinding\nmetadata:\n  name: kubernetes-dashboard\nroleRef:\n  apiGroup: rbac.authorization.k8s.io\n  kind: ClusterRole\n  name: kubernetes-dashboard\nsubjects:\n  - kind: ServiceAccount\n    name: kubernetes-dashboard\n    namespace: kubernetes-dashboard\n\n---\n\nkind: Deployment\napiVersion: apps/v1\nmetadata:\n  labels:\n    k8s-app: kubernetes-dashboard\n  name: kubernetes-dashboard\n  namespace: kubernetes-dashboard\nspec:\n  replicas: 1\n  revisionHistoryLimit: 10\n  selector:\n    matchLabels:\n      k8s-app: kubernetes-dashboard\n  template:\n    metadata:\n      labels:\n        k8s-app: kubernetes-dashboard\n    spec:\n      containers:\n        - name: kubernetes-dashboard\n          image: registry.cn-hangzhou.aliyuncs.com/xxk8s/dashboard:v2.3.1\n          imagePullPolicy: Always\n          ports:\n            - containerPort: 8443\n              protocol: TCP\n          args:\n            - --auto-generate-certificates\n            - --namespace=kubernetes-dashboard\n            # Uncomment the following line to manually specify Kubernetes API server Host\n            # If not specified, Dashboard will attempt to auto discover the API server and connect\n            # to it. Uncomment only if the default does not work.\n            # - --apiserver-host=http://my-address:port\n          volumeMounts:\n            - name: kubernetes-dashboard-certs\n              mountPath: /certs\n              # Create on-disk volume to store exec logs\n            - mountPath: /tmp\n              name: tmp-volume\n          livenessProbe:\n            httpGet:\n              scheme: HTTPS\n              path: /\n              port: 8443\n            initialDelaySeconds: 30\n            timeoutSeconds: 30\n          securityContext:\n            allowPrivilegeEscalation: false\n            readOnlyRootFilesystem: true\n            runAsUser: 1001\n            runAsGroup: 2001\n      volumes:\n        - name: kubernetes-dashboard-certs\n          secret:\n            secretName: kubernetes-dashboard-certs\n        - name: tmp-volume\n          emptyDir: {}\n      serviceAccountName: kubernetes-dashboard\n      nodeSelector:\n        "kubernetes.io/os": linux\n      # Comment the following tolerations if Dashboard must not be deployed on master\n      tolerations:\n        - key: node-role.kubernetes.io/master\n          effect: NoSchedule\n\n---\n\nkind: Service\napiVersion: v1\nmetadata:\n  labels:\n    k8s-app: dashboard-metrics-scraper\n  name: dashboard-metrics-scraper\n  namespace: kubernetes-dashboard\nspec:\n  ports:\n    - port: 8000\n      targetPort: 8000\n  selector:\n    k8s-app: dashboard-metrics-scraper\n\n---\n\nkind: Deployment\napiVersion: apps/v1\nmetadata:\n  labels:\n    k8s-app: dashboard-metrics-scraper\n  name: dashboard-metrics-scraper\n  namespace: kubernetes-dashboard\nspec:\n  replicas: 1\n  revisionHistoryLimit: 10\n  selector:\n    matchLabels:\n      k8s-app: dashboard-metrics-scraper\n  template:\n    metadata:\n      labels:\n        k8s-app: dashboard-metrics-scraper\n      annotations:\n        seccomp.security.alpha.kubernetes.io/pod: \'runtime/default\'\n    spec:\n      containers:\n        - name: dashboard-metrics-scraper\n          image: registry.cn-hangzhou.aliyuncs.com/xxk8s/metrics-scraper:v1.0.6\n          ports:\n            - containerPort: 8000\n              protocol: TCP\n          livenessProbe:\n            httpGet:\n              scheme: HTTP\n              path: /\n              port: 8000\n            initialDelaySeconds: 30\n            timeoutSeconds: 30\n          volumeMounts:\n          - mountPath: /tmp\n            name: tmp-volume\n          securityContext:\n            allowPrivilegeEscalation: false\n            readOnlyRootFilesystem: true\n            runAsUser: 1001\n            runAsGroup: 2001\n      serviceAccountName: kubernetes-dashboard\n      nodeSelector:\n        "kubernetes.io/os": linux\n      # Comment the following tolerations if Dashboard must not be deployed on master\n      tolerations:\n        - key: node-role.kubernetes.io/master\n          effect: NoSchedule\n      volumes:\n        - name: tmp-volume\n          emptyDir: {}\n'})}),"\n",(0,a.jsxs)(n.blockquote,{children:["\n",(0,a.jsx)(n.p,{children:"\u5728 YAML \u6587\u4ef6\u4e2d\u53ef\u4ee5\u770b\u5230\u65b0\u7248\u672c Dashboard \u96c6\u6210\u4e86\u4e00\u4e2a metrics-scraper \u7684\u7ec4\u4ef6\uff0c\u53ef\u4ee5\u901a\u8fc7 Kubernetes \u7684 Metrics API \u6536\u96c6\u4e00\u4e9b\u57fa\u7840\u8d44\u6e90\u7684\u76d1\u63a7\u4fe1\u606f\uff0c\u5e76\u5728 web \u9875\u9762\u4e0a\u5c55\u793a\uff0c\u6240\u4ee5\u8981\u60f3\u5728\u9875\u9762\u4e0a\u5c55\u793a\u76d1\u63a7\u4fe1\u606f\u5c31\u9700\u8981\u63d0\u4f9b Metrics API\uff0c\u6bd4\u5982\u5b89\u88c5 Metrics Server\u3002"}),"\n"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f recommended.yaml\n\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u65b0\u7248\u672c\u7684 Dashboard \u4f1a\u88ab\u9ed8\u8ba4\u5b89\u88c5\u5728 kubernetes-dashboard \u8fd9\u4e2a\u547d\u540d\u7a7a\u95f4\u4e0b\u9762\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"root@master1:/k8s-data/system-yaml# kubectl get pods -n kubernetes-dashboard -o wide\nNAME                                         READY   STATUS    RESTARTS   AGE     IP          NODE    NOMINATED NODE   READINESS GATES\ndashboard-metrics-scraper-856586f554-xtzm9   1/1     Running   0          2m43s   10.88.0.2   node1   <none>           <none>\nkubernetes-dashboard-67484c44f6-q6rwd        1/1     Running   0          2m43s   10.88.0.2   node2   <none>           <none>\n\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\u6211\u4eec\u4ed4\u7ec6\u770b\u53ef\u4ee5\u53d1\u73b0\u4e0a\u9762\u7684 Pod \u5206\u914d\u7684 IP \u6bb5\u662f ",(0,a.jsx)(n.code,{children:"10.88.xx.xx"}),"\uff0c\u5305\u62ec\u524d\u9762\u81ea\u52a8\u5b89\u88c5\u7684 CoreDNS \u4e5f\u662f\u5982\u6b64\uff0c\u6211\u4eec\u524d\u9762\u4e0d\u662f\u914d\u7f6e\u7684 ",(0,a.jsx)(n.code,{children:"podSubnet"})," \u4e3a ",(0,a.jsx)(n.code,{children:"10.244.0.0/16"})," \u5417\uff1f\u6211\u4eec\u5148\u53bb\u67e5\u770b\u4e0b CNI \u7684\u914d\u7f6e\u6587\u4ef6\uff1a"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"root@master1:/k8s-data/system-yaml# ls -la /etc/cni/net.d/\ntotal 20\ndrwxr-xr-x 2 root root 4096 Mar  4 20:20 .\ndrwxr-xr-x 3 root root 4096 Sep 14 07:09 ..\n-rw-r--r-- 1 root root  604 Sep 14 07:09 10-containerd-net.conflist\n-rw-r--r-- 1 root root  292 Mar  4 20:20 10-flannel.conflist\n-rw-r--r-- 1 root root  860 Mar  1 15:39 nerdctl-bridge.conflist\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\u53ef\u4ee5\u770b\u5230\u91cc\u9762\u5305\u542b\u4e24\u4e2a\u914d\u7f6e\uff0c\u4e00\u4e2a\u662f ",(0,a.jsx)(n.code,{children:"10-containerd-net.conflist"}),"\uff0c\u53e6\u5916\u4e00\u4e2a\u662f\u6211\u4eec\u4e0a\u9762\u521b\u5efa\u7684 Flannel \u7f51\u7edc\u63d2\u4ef6\u751f\u6210\u7684\u914d\u7f6e\uff0c\u6211\u4eec\u7684\u9700\u6c42\u80af\u5b9a\u662f\u60f3\u4f7f\u7528 Flannel \u7684\u8fd9\u4e2a\u914d\u7f6e\uff0c\u6211\u4eec\u53ef\u4ee5\u67e5\u770b\u4e0b containerd \u8fd9\u4e2a\u81ea\u5e26\u7684 cni \u63d2\u4ef6\u914d\u7f6e\uff1a"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:'{\n  "cniVersion": "1.0.0",\n  "name": "containerd-net",\n  "plugins": [\n    {\n      "type": "bridge",\n      "bridge": "cni0",\n      "isGateway": true,\n      "ipMasq": true,\n      "promiscMode": true,\n      "ipam": {\n        "type": "host-local",\n        "ranges": [\n          [{\n            "subnet": "10.88.0.0/16"\n          }],\n          [{\n            "subnet": "2001:4860:4860::/64"\n          }]\n        ],\n        "routes": [\n          { "dst": "0.0.0.0/0" },\n          { "dst": "::/0" }\n        ]\n      }\n    },\n    {\n      "type": "portmap",\n      "capabilities": {"portMappings": true}\n    }\n  ]\n\n'})}),"\n",(0,a.jsxs)(n.p,{children:["\u53ef\u4ee5\u770b\u5230\u4e0a\u9762\u7684 IP \u6bb5\u6070\u597d\u5c31\u662f ",(0,a.jsx)(n.code,{children:"10.88.0.0/16"}),"\uff0c\u4f46\u662f\u8fd9\u4e2a cni \u63d2\u4ef6\u7c7b\u578b\u662f bridge \u7f51\u7edc\uff0c\u7f51\u6865\u7684\u540d\u79f0\u4e3a cni0\uff1a"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"8: cni0: <BROADCAST,MULTICAST,PROMISC,UP,LOWER_UP> mtu 1500 qdisc noqueue state UP group default qlen 1000\n    link/ether 1a:9e:91:4a:c7:87 brd ff:ff:ff:ff:ff:ff\n    inet 10.88.0.1/16 brd 10.88.255.255 scope global cni0\n       valid_lft forever preferred_lft forever\n    inet6 2001:4860:4860::1/64 scope global\n       valid_lft forever preferred_lft forever\n    inet6 fe80::189e:91ff:fe4a:c787/64 scope link\n       valid_lft forever preferred_lft forever\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\u4f46\u662f\u4f7f\u7528 bridge \u7f51\u7edc\u7684\u5bb9\u5668\u65e0\u6cd5\u8de8\u591a\u4e2a\u5bbf\u4e3b\u673a\u8fdb\u884c\u901a\u4fe1\uff0c\u8de8\u4e3b\u673a\u901a\u4fe1\u9700\u8981\u501f\u52a9\u5176\u4ed6\u7684 cni \u63d2\u4ef6\uff0c\u6bd4\u5982\u4e0a\u9762\u6211\u4eec\u5b89\u88c5\u7684 Flannel\uff0c\u6216\u8005 Calico \u7b49\u7b49\uff0c\u7531\u4e8e\u6211\u4eec\u8fd9\u91cc\u6709\u4e24\u4e2a cni \u914d\u7f6e\uff0c\u6240\u4ee5\u6211\u4eec\u9700\u8981\u5c06 ",(0,a.jsx)(n.code,{children:"10-containerd-net.conflist"})," \u8fd9\u4e2a\u914d\u7f6e\u5220\u9664\uff0c\u56e0\u4e3a\u5982\u679c\u8fd9\u4e2a\u76ee\u5f55\u4e2d\u6709\u591a\u4e2a cni \u914d\u7f6e\u6587\u4ef6\uff0ckubelet \u5c06\u4f1a\u4f7f\u7528\u6309\u6587\u4ef6\u540d\u7684\u5b57\u5178\u987a\u5e8f\u6392\u5217\u7684\u7b2c\u4e00\u4e2a\u4f5c\u4e3a\u914d\u7f6e\u6587\u4ef6\uff0c\u6240\u4ee5\u524d\u9762\u9ed8\u8ba4\u9009\u62e9\u4f7f\u7528\u7684\u662f containerd-net \u8fd9\u4e2a\u63d2\u4ef6\u3002"]}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"mv /etc/cni/net.d/10-containerd-net.conflist /etc/cni/net.d/10-containerd-net.conflist.bak\nifconfig cni0 down && ip link delete cni0\nsystemctl daemon-reload\nsystemctl restart containerd kubelet\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u7136\u540e\u8bb0\u5f97\u91cd\u5efa coredns \u548c dashboard \u7684 Pod\uff0c\u91cd\u5efa\u540e Pod \u7684 IP \u5730\u5740\u5c31\u6b63\u5e38\u4e86\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubectl get pods -n kube-system -o wide -l k8s-app=kube-dns\nNAME                       READY   STATUS    RESTARTS   AGE   IP           NODE    NOMINATED NODE   READINESS GATES\ncoredns-7d89d9b6b8-mb59w   1/1     Running   0          11s   10.244.1.2   node1   <none>           <none>\ncoredns-7d89d9b6b8-rlfzw   1/1     Running   0          22s   10.244.2.2   node2   <none>           <none>\n\nroot@master1:/k8s-data/system-yaml# kubectl get pods -n kubernetes-dashboard -o wide\nNAME                                         READY   STATUS    RESTARTS   AGE   IP           NODE    NOMINATED NODE   READINESS GATES\ndashboard-metrics-scraper-856586f554-8jbzl   1/1     Running   0          42s   10.244.1.3   node1   <none>           <none>\nkubernetes-dashboard-67484c44f6-p64d7        1/1     Running   0          23s   10.244.2.3   node2   <none>           <none>\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"10: cni0: <BROADCAST,MULTICAST,UP,LOWER_UP> mtu 1450 qdisc noqueue state UP group default qlen 1000\n    link/ether d6:5a:fd:a0:dd:50 brd ff:ff:ff:ff:ff:ff\n    inet 10.244.1.1/24 brd 10.244.1.255 scope global cni0\n       valid_lft forever preferred_lft forever\n    inet6 fe80::d45a:fdff:fea0:dd50/64 scope link\n       valid_lft forever preferred_lft forever\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u67e5\u770b Dashboard \u7684 NodePort \u7aef\u53e3\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubectl get svc -n kubernetes-dashboard\nNAME                        TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)         AGE\ndashboard-metrics-scraper   ClusterIP   10.98.120.247   <none>        8000/TCP        16m\nkubernetes-dashboard        NodePort    10.98.30.97     <none>        443:30036/TCP   16m\n\n"})}),"\n",(0,a.jsxs)(n.p,{children:["\u7136\u540e\u53ef\u4ee5\u901a\u8fc7\u4e0a\u9762\u7684 30036 \u7aef\u53e3\u53bb\u8bbf\u95ee Dashboard\uff0c\u8981\u8bb0\u4f4f\u4f7f\u7528 https",(0,a.jsx)("br",{}),(0,a.jsx)(n.img,{src:"https://cdn.nlark.com/yuque/0/2024/png/33538388/1709558342318-2b4a27ab-07e3-4c6e-bb1c-453aa8b4e85a.png#averageHue=%23c9f0ef&clientId=u1cc09a82-24b9-4&from=paste&height=851&id=ub83c3837&originHeight=851&originWidth=1769&originalType=binary&ratio=1&rotation=0&showTitle=false&size=51732&status=done&style=none&taskId=u2a798155-6e2f-4580-bb63-652812b27d5&title=&width=1769",alt:"image.png"})]}),"\n",(0,a.jsx)(n.p,{children:"\u7136\u540e\u521b\u5efa\u4e00\u4e2a\u5177\u6709\u5168\u5c40\u6240\u6709\u6743\u9650\u7684\u7528\u6237\u6765\u767b\u5f55 Dashboard\uff1a(admin.yaml)"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-yaml",children:"kind: ClusterRoleBinding\napiVersion: rbac.authorization.k8s.io/v1\nmetadata:\n  name: admin\nroleRef:\n  kind: ClusterRole\n  name: cluster-admin\n  apiGroup: rbac.authorization.k8s.io\nsubjects:\n  - kind: ServiceAccount\n    name: admin\n    namespace: kubernetes-dashboard\n---\napiVersion: v1\nkind: ServiceAccount\nmetadata:\n  name: admin\n  namespace: kubernetes-dashboard\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u76f4\u63a5\u521b\u5efa\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubectl apply -f admin.yaml\nroot@master1:/k8s-data/system-yaml# kubectl get secret -n kubernetes-dashboard|grep admin-token\nadmin-token-n67hl                  kubernetes.io/service-account-token   3      7s\n\n\nroot@master1:/k8s-data/system-yaml# kubectl get secret admin-token-n67hl -o jsonpath={.data.token} -n kubernetes-dashboard |base64 -d\neyJhbGciOiJSUzI1NiIsImtpZCI6IkJUN1ZoRDFvdlZaSG1EOGViM0N3eGtoaU9od2ttSjJvcE9WQV80aDlIV1EifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJhZG1pbi10b2tlbi1uNjdobCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJhZG1pbiIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6IjE0Zjc3MzFlLTk0MTQtNDU4MC05MDk1LWE0MTBjZDFkZDhhYSIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDprdWJlcm5ldGVzLWRhc2hib2FyZDphZG1pbiJ9.tNjHtr6aBvR4kvdaxb6xr0kRd6YbdmVrM-MU8puEHQYnoncVXaRy7CI9MZ1cVvD89yled-WFSUWnkYDSP4CcjSvqPTpulJku5yTM-JEEdJQSav7nOLnhqdNScpO8Iqo_U1KVirN5zO_sBDjBnA6qX1vYhhZGy43NGXLTCiQXS6Sv4zIXH6VhsuM5wvoYHayIKAqZ7upcWK7fHnixbOoC4xvEjRy7StUfdrGXOaakaF5KdrKVTwtwYlK3URFGNIWNoQi7eOSsu-7ITQRESB40PxVnrGLaWCjOURX3AC-hYNO3qraPHuXIsiGr-XlOfX32Ub8KA-jtEHJ7iIc_N4Tmjwroot@master1:/k8s-data\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"eyJhbGciOiJSUzI1NiIsImtpZCI6IkJUN1ZoRDFvdlZaSG1EOGViM0N3eGtoaU9od2ttSjJvcE9WQV80aDlIV1EifQ.eyJpc3MiOiJrdWJlcm5ldGVzL3NlcnZpY2VhY2NvdW50Iiwia3ViZXJuZXRlcy5pby9zZXJ2aWNlYWNjb3VudC9uYW1lc3BhY2UiOiJrdWJlcm5ldGVzLWRhc2hib2FyZCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VjcmV0Lm5hbWUiOiJhZG1pbi10b2tlbi1uNjdobCIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50Lm5hbWUiOiJhZG1pbiIsImt1YmVybmV0ZXMuaW8vc2VydmljZWFjY291bnQvc2VydmljZS1hY2NvdW50LnVpZCI6IjE0Zjc3MzFlLTk0MTQtNDU4MC05MDk1LWE0MTBjZDFkZDhhYSIsInN1YiI6InN5c3RlbTpzZXJ2aWNlYWNjb3VudDprdWJlcm5ldGVzLWRhc2hib2FyZDphZG1pbiJ9.tNjHtr6aBvR4kvdaxb6xr0kRd6YbdmVrM-MU8puEHQYnoncVXaRy7CI9MZ1cVvD89yled-WFSUWnkYDSP4CcjSvqPTpulJku5yTM-JEEdJQSav7nOLnhqdNScpO8Iqo_U1KVirN5zO_sBDjBnA6qX1vYhhZGy43NGXLTCiQXS6Sv4zIXH6VhsuM5wvoYHayIKAqZ7upcWK7fHnixbOoC4xvEjRy7StUfdrGXOaakaF5KdrKVTwtwYlK3URFGNIWNoQi7eOSsu-7ITQRESB40PxVnrGLaWCjOURX3AC-hYNO3qraPHuXIsiGr-XlOfX32Ub8KA-jtEHJ7iIc_N4Tmjw\n"})}),"\n",(0,a.jsx)(n.p,{children:"\u7136\u540e\u7528\u4e0a\u9762\u7684 base64 \u89e3\u7801\u540e\u7684\u5b57\u7b26\u4e32\u4f5c\u4e3a token \u767b\u5f55 Dashboard \u5373\u53ef\uff0c\u65b0\u7248\u672c\u8fd8\u65b0\u589e\u4e86\u4e00\u4e2a\u6697\u9ed1\u6a21\u5f0f\uff1a"}),"\n",(0,a.jsx)(n.p,{children:(0,a.jsx)(n.img,{src:"https://cdn.nlark.com/yuque/0/2024/png/33538388/1709558599777-aae14830-3115-4a45-8da5-cb46638bc98d.png#averageHue=%23d5b786&clientId=u1cc09a82-24b9-4&from=paste&height=927&id=u2f251bc7&originHeight=927&originWidth=1889&originalType=binary&ratio=1&rotation=0&showTitle=false&size=108206&status=done&style=none&taskId=u732bbc19-5b43-48cc-8f1c-d39b73fc607&title=&width=1889",alt:"image.png"})}),"\n",(0,a.jsx)(n.p,{children:"\u6700\u7ec8\u6211\u4eec\u5c31\u5b8c\u6210\u4e86\u4f7f\u7528 kubeadm \u642d\u5efa v1.22.1 \u7248\u672c\u7684 kubernetes \u96c6\u7fa4\u3001coredns\u3001ipvs\u3001flannel\u3001containerd\u3002"}),"\n",(0,a.jsx)("a",{name:"FGAby"}),"\n",(0,a.jsx)(n.h2,{id:"\u6e05\u7406",children:"\u6e05\u7406"}),"\n",(0,a.jsx)(n.p,{children:"\u5982\u679c\u4f60\u7684\u96c6\u7fa4\u5b89\u88c5\u8fc7\u7a0b\u4e2d\u9047\u5230\u4e86\u5176\u4ed6\u95ee\u9898\uff0c\u6211\u4eec\u53ef\u4ee5\u4f7f\u7528\u4e0b\u9762\u7684\u547d\u4ee4\u6765\u8fdb\u884c\u91cd\u7f6e\uff1a"}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{children:"kubeadm reset\nifconfig cni0 down && ip link delete cni0\nifconfig flannel.1 down && ip link delete flannel.1\nrm -rf /var/lib/cni/\n"})}),"\n",(0,a.jsx)(n.pre,{children:(0,a.jsx)(n.code,{className:"language-bash",children:"kubeadm reset\nsystemctl daemon-reload\nsystemctl restart kubelet\niptables -F && iptables -t nat -F && iptables -t mangle -F && iptables -X\n"})})]})}function u(e={}){const{wrapper:n}={...(0,r.R)(),...e.components};return n?(0,a.jsx)(n,{...e,children:(0,a.jsx)(l,{...e})}):l(e)}},8453:(e,n,t)=>{t.d(n,{R:()=>i,x:()=>o});var a=t(6540);const r={},s=a.createContext(r);function i(e){const n=a.useContext(s);return a.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:i(e.components),a.createElement(s.Provider,{value:n},e.children)}}}]);